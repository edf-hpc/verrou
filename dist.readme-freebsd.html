<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>13.Â README.freebsd</title>
<link rel="stylesheet" type="text/css" href="vg_basic.css">
<meta name="generator" content="DocBook XSL Stylesheets V1.79.1">
<link rel="home" href="index.html" title="Valgrind Documentation">
<link rel="up" href="dist.html" title="Valgrind Distribution Documents">
<link rel="prev" href="dist.readme-solaris.html" title="12.Â README.solaris">
<link rel="next" href="licenses.html" title="GNU Licenses">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div><table class="nav" width="100%" cellspacing="3" cellpadding="3" border="0" summary="Navigation header"><tr>
<td width="22px" align="center" valign="middle"><a accesskey="p" href="dist.readme-solaris.html"><img src="images/prev.png" width="18" height="21" border="0" alt="Prev"></a></td>
<td width="25px" align="center" valign="middle"><a accesskey="u" href="dist.html"><img src="images/up.png" width="21" height="18" border="0" alt="Up"></a></td>
<td width="31px" align="center" valign="middle"><a accesskey="h" href="index.html"><img src="images/home.png" width="27" height="20" border="0" alt="Up"></a></td>
<th align="center" valign="middle">Valgrind Distribution Documents</th>
<td width="22px" align="center" valign="middle"><a accesskey="n" href="licenses.html"><img src="images/next.png" width="18" height="21" border="0" alt="Next"></a></td>
</tr></table></div>
<div class="chapter">
<div class="titlepage"><div><div><h1 class="title">
<a name="dist.readme-freebsd"></a>13.Â README.freebsd</h1></div></div></div>
<div class="literallayout"><p><br>
Â Â Â Â Â Â InstallingÂ fromÂ portsÂ orÂ viaÂ pkg<br>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>
<br>
IfÂ youÂ areÂ usingÂ FreeBSDÂ 11.3Â orÂ later,Â thenÂ youÂ shouldÂ beÂ ableÂ toÂ install<br>
ValgrindÂ usingÂ either<br>
<br>
pkgÂ installÂ devel/valgrind<br>
<br>
orÂ alternativelyÂ fromÂ portsÂ (ifÂ installed)<br>
<br>
cdÂ /usr/ports/devel/valgrindÂ &amp;&amp;Â makeÂ installÂ clean<br>
<br>
<br>
BuildingÂ Valgrind<br>
~~~~~~~~~~~~~~~~~<br>
<br>
InstallÂ portsÂ forÂ autoconf,Â automake,Â libtoolÂ andÂ gmake.<br>
<br>
$Â shÂ autogen.sh<br>
$Â ./configureÂ --prefix=/where/ever<br>
$Â gmake<br>
$Â gmakeÂ install<br>
<br>
KnownÂ LimitationsÂ (JuneÂ 2022)<br>
<br>
0.Â BeÂ awareÂ thatÂ ifÂ youÂ useÂ aÂ wrapperÂ scriptÂ andÂ runÂ ValgrindÂ onÂ theÂ wrapper<br>
Â Â Â scriptÂ ValgrindÂ mayÂ hitÂ restrictionsÂ ifÂ theÂ wrapperÂ scriptÂ runsÂ any<br>
Â Â Â CapsicumÂ enabledÂ applications.Â ExamplesÂ ofÂ CapsicumÂ enabledÂ applications<br>
Â Â Â areÂ echo,Â basename,Â tee,Â uniqÂ andÂ wc.Â ItÂ isÂ recommendedÂ thatÂ youÂ either<br>
Â Â Â avoidÂ theseÂ applicationsÂ orÂ thatÂ youÂ runÂ ValgrindÂ directlyÂ onÂ yourÂ test<br>
Â Â Â application.<br>
1.Â ThereÂ areÂ someÂ limitationsÂ whenÂ runningÂ ValgrindÂ onÂ codeÂ thatÂ wasÂ compiled<br>
Â Â Â withÂ clang.Â Â TheseÂ issuesÂ areÂ notÂ presentÂ withÂ codeÂ compiledÂ withÂ GCC.<br>
Â Â Â a)Â ThereÂ mayÂ beÂ missingÂ sourceÂ informationÂ concerningÂ variablesÂ due<br>
Â Â Â Â Â Â toÂ DWARFÂ extensionsÂ isedÂ byÂ GCC.<br>
Â Â Â b)Â CodeÂ thatÂ usesÂ OpenMPÂ willÂ generateÂ spuriousÂ errors.<br>
2.Â vgdbÂ invoker,Â whichÂ usesÂ ptrace,Â mayÂ causeÂ systemÂ callsÂ toÂ be<br>
Â Â Â interrupted.<br>
<br>
NotesÂ forÂ Developers<br>
~~~~~~~~~~~~~~~~~~~~<br>
<br>
SeeÂ README_DEVELOPERS,Â README_MISSING_SYSCALL_OR_IOCTLÂ andÂ docs/*<br>
forÂ moreÂ generalÂ informationÂ forÂ developers.<br>
<br>
0.Â AddingÂ syscalls.<br>
<br>
WhenÂ addingÂ syscalls,Â youÂ needÂ toÂ lookÂ atÂ theÂ manpageÂ andÂ alsoÂ syscalls.master<br>
(onlineÂ at<br>
https://github.com/freebsd/freebsd/blob/master/sys/kern/syscalls.master<br>
andÂ forÂ 32bit<br>
https://github.com/freebsd/freebsd/blob/master/sys/compat/freebsd32/syscalls.master<br>
<br>
andÂ ifÂ youÂ installedÂ theÂ srcÂ packageÂ thereÂ shouldÂ alsoÂ be<br>
<br>
/usr/src/sys/kern/syscalls.master<br>
and<br>
/usr/src/sys/compat/freebsd32/syscalls.master)<br>
<br>
syscalls.masterÂ isÂ particularlyÂ usefulÂ forÂ seeingÂ quicklyÂ whetherÂ parameters<br>
areÂ inputsÂ orÂ outputs.<br>
<br>
TheÂ syscallÂ wrappersÂ canÂ varyÂ fromÂ trivialÂ toÂ difficult.Â Fortunately,Â manyÂ are<br>
eitherÂ trivialÂ (noÂ arguments)Â orÂ easyÂ (ValgrindÂ justÂ needsÂ toÂ knowÂ whatÂ memory<br>
isÂ beingÂ readÂ orÂ written).Â SomeÂ syscalls,Â suchÂ asÂ thoseÂ involvingÂ process<br>
creationÂ andÂ termination,Â signalsÂ andÂ memoryÂ mappingÂ requireÂ deeperÂ interaction<br>
withÂ Valgrind.<br>
<br>
WhenÂ youÂ addÂ syscallsÂ youÂ willÂ needÂ toÂ modifyÂ severalÂ files<br>
Â Â Â a)Â include/vki/vki-scnums-freebsd.h<br>
Â Â Â Â Â Â ThisÂ fileÂ containsÂ oneÂ #defineÂ forÂ eachÂ syscall.Â TheÂ _NR_Â prefixÂ (Linux<br>
Â Â Â Â Â Â style)Â isÂ usedÂ ratherÂ thanÂ SYS_Â forÂ compatibilityÂ withÂ theÂ restÂ ofÂ the<br>
Â Â Â Â Â Â ValgrindÂ source.<br>
Â Â Â b)Â coregrind/m_syswrap/priv_syswrap-freebsd.h<br>
Â Â Â Â Â Â ThisÂ usesÂ theÂ DECL_TEMPLATEÂ macroÂ toÂ generateÂ declarationsÂ forÂ theÂ syscall<br>
Â Â Â Â Â Â beforeÂ andÂ afterÂ wrappers.<br>
Â Â Â c)Â coregrind/m_syswrap/syswrap-freebsd.c<br>
Â Â Â Â Â Â ThisÂ isÂ whereÂ theÂ bulkÂ ofÂ theÂ codeÂ resides.Â TowardÂ theÂ endÂ ofÂ theÂ file<br>
Â Â Â Â Â Â theÂ BSDX_/BSDXYÂ macrosÂ areÂ usedÂ toÂ generateÂ entriesÂ inÂ theÂ tableÂ of<br>
Â Â Â Â Â Â syscalls.Â BSDX_Â isÂ usedÂ forÂ wrappersÂ thatÂ onlyÂ haveÂ aÂ 'before',Â BSDXY<br>
Â Â Â Â Â Â ifÂ bothÂ wrappersÂ areÂ required.Â InÂ general,Â syscallsÂ thatÂ haveÂ noÂ arguments<br>
Â Â Â Â Â Â orÂ onlyÂ inputÂ argumentsÂ justÂ needÂ aÂ BSDX_Â macroÂ (beforeÂ only).Â Syscalls<br>
Â Â Â Â Â Â withÂ outputÂ argumentsÂ needÂ aÂ BSDXYÂ macroÂ (beforeÂ andÂ after).<br>
Â Â Â d)Â IfÂ theÂ syscallÂ usesÂ 64bitÂ argumentsÂ (longÂ long)Â thenÂ insteadÂ ofÂ putting<br>
Â Â Â Â Â Â theÂ wrapperÂ definitionsÂ inÂ syswrap-freebsd.cÂ thereÂ willÂ beÂ oneÂ definition<br>
Â Â Â Â Â Â forÂ eachÂ platformÂ amd64Â andÂ x86Â inÂ syswrap-x86-freebsd.cÂ and<br>
Â Â Â Â Â Â syswrap-amd64-freebsd.c.<br>
Â Â Â Â Â Â EachÂ longÂ longÂ needsÂ toÂ beÂ splitÂ intoÂ twoÂ ARGsÂ inÂ theÂ x86Â version.<br>
<br>
TheÂ PREÂ (before)Â wrapper<br>
------------------------<br>
<br>
EachÂ PREÂ wrapperÂ alwaysÂ containsÂ theÂ followingÂ twoÂ macroÂ calls<br>
<br>
PRINT.Â ThisÂ outputsÂ theÂ syscallÂ nameÂ andÂ argumentÂ valuesÂ whenÂ ValgrindÂ is<br>
executedÂ with<br>
--trace-syscalls=yes<br>
<br>
PRE_READ_REGX.Â ThisÂ macroÂ letsÂ ValgrindÂ knowÂ aboutÂ theÂ numberÂ andÂ typesÂ ofÂ the<br>
syscallÂ argumentsÂ whichÂ allowsÂ ValgrindÂ toÂ checkÂ thatÂ theyÂ areÂ initialized.<br>
XÂ isÂ theÂ numberÂ ofÂ arguments.Â ItÂ isÂ bestÂ thatÂ theÂ argumentÂ namesÂ match<br>
theÂ manÂ page,Â butÂ theÂ mustÂ matchÂ theÂ typesÂ andÂ numberÂ ofÂ argumentsÂ in<br>
syscalls.master.<br>
OccasionallyÂ thereÂ areÂ differencesÂ betweenÂ theÂ two.<br>
<br>
IfÂ theÂ syscallÂ takesÂ pointersÂ toÂ memoryÂ thereÂ willÂ beÂ oneÂ ofÂ theÂ followingÂ for<br>
eachÂ pointerÂ argument.<br>
<br>
PRE_MEM_RASCIIZÂ forÂ NULLÂ terminatedÂ asciiÂ strings.<br>
<br>
PRE_MEM_READÂ forÂ pointersÂ toÂ structuresÂ orÂ arraysÂ thatÂ areÂ read.<br>
<br>
PRE_MEM_WRITEÂ forÂ pointersÂ toÂ structuresÂ orÂ arraysÂ thatÂ areÂ written.<br>
<br>
AsÂ aÂ rule,Â theÂ definitionsÂ ofÂ structuresÂ areÂ copiedÂ intoÂ vki-freebsd.h<br>
withÂ theÂ vki-Â prefix.Â [vkiÂ -Â ValgrindÂ kernelÂ interface;Â thisÂ wasÂ done<br>
historicallyÂ toÂ protectÂ againstÂ discrepanciesÂ betweenÂ userÂ include<br>
structureÂ definitionsÂ andÂ kernelÂ definitionsÂ onÂ Linux].<br>
<br>
TheÂ POSTÂ (after)Â wrapper<br>
------------------------<br>
<br>
TheseÂ areÂ muchÂ easier.<br>
<br>
TheyÂ justÂ containÂ aÂ POST_MEM_WRITEÂ macroÂ forÂ eachÂ outputÂ argument.<br>
<br>
1.Â RunningÂ regressionÂ tests<br>
<br>
InÂ orderÂ toÂ runÂ allÂ ofÂ theÂ regressionÂ testsÂ youÂ willÂ needÂ toÂ install<br>
theÂ followingÂ packages<br>
gdb<br>
gsed<br>
<br>
InÂ additionÂ toÂ runningÂ "make"Â youÂ willÂ needÂ toÂ run<br>
"makeÂ check"Â toÂ buildÂ theÂ regressionÂ testÂ exectutables<br>
andÂ "makeÂ regtest".Â Â Again,Â moreÂ detailsÂ canÂ beÂ seenÂ in<br>
README_DEVELOPERS.<br>
<br>
IfÂ youÂ wantÂ toÂ runÂ theÂ 'nightly'Â scriptÂ (seeÂ nightly/README.txt)<br>
youÂ willÂ needÂ toÂ installÂ coreutilsÂ andÂ modifyÂ the<br>
nightly/conf/freebsd.*Â files.Â TheÂ defaultÂ configuration<br>
sendsÂ anÂ e-mailÂ toÂ theÂ valgrind-testresultsÂ mailingÂ list.<br>
<br>
Feedback<br>
~~~~~~~~<br>
<br>
IfÂ youÂ findÂ anyÂ problemsÂ pleaseÂ createÂ aÂ bugzillaÂ reportÂ at<br>
https://bugs.kde.orgÂ usingÂ theÂ ValgrindÂ product.<br>
<br>
AlternativelyÂ youÂ canÂ useÂ theÂ FreeBSDÂ bugilla<br>
https://bugs.freebsd.org<br>
<br>
Credits<br>
~~~~~~~<br>
<br>
ValgrindÂ wasÂ originallyÂ portedÂ toÂ FreeBSDÂ byÂ DougÂ Rabson<br>
inÂ 2004.<br>
<br>
PaulÂ FloydÂ (that'sÂ me),Â startedÂ lookingÂ atÂ thisÂ projectÂ inÂ lateÂ 2018,<br>
tookÂ aÂ longÂ pauseÂ andÂ thenÂ continuedÂ inÂ earnestÂ inÂ JanuaryÂ 2020.<br>
<br>
AÂ bigÂ thanksÂ toÂ NickÂ BriggsÂ forÂ helpingÂ withÂ theÂ x86Â version.<br>
<br>
KyleÂ EvansÂ andÂ EdÂ MasteÂ forÂ contributingÂ patchesÂ andÂ helpingÂ withÂ the<br>
integrationÂ withÂ FreeBSDÂ ports.<br>
<br>
PriorÂ toÂ 2018Â manyÂ othersÂ haveÂ alsoÂ contributed.<br>
<br>
DimitryÂ Andric<br>
SimonÂ Barner<br>
RomanÂ Bogorodskiy<br>
RebeccaÂ Cran<br>
BryanÂ Drewery<br>
BrianÂ FundakowskiÂ Feldman<br>
DenisÂ Generalov<br>
MikolajÂ Golub<br>
EugeneÂ Kilachkoff<br>
XinÂ LI<br>
PhilÂ Longstaff<br>
PavÂ Lucistnik<br>
ConradÂ Meyer<br>
JulienÂ Nadeau<br>
FrerichÂ Raabe<br>
DougÂ Rabson<br>
CraigÂ Rodrigues<br>
TomÂ Russo<br>
StephenÂ Sanders<br>
StanislavÂ Sedov<br>
AndreiÂ V.Â Shetuhin<br>
NiklasÂ Sorensson<br>
RyanÂ Stone<br>
JerryÂ Toung<br>
Yuri<br>
<br>
<br>
Â Â Â Â </p></div>
</div>
<div>
<br><table class="nav" width="100%" cellspacing="3" cellpadding="2" border="0" summary="Navigation footer">
<tr>
<td rowspan="2" width="40%" align="left">
<a accesskey="p" href="dist.readme-solaris.html">&lt;&lt;Â 12.Â README.solaris</a>Â </td>
<td width="20%" align="center"><a accesskey="u" href="dist.html">Up</a></td>
<td rowspan="2" width="40%" align="right">Â <a accesskey="n" href="licenses.html">GNU LicensesÂ &gt;&gt;</a>
</td>
</tr>
<tr><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td></tr>
</table>
</div>
</body>
</html>
