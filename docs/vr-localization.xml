<?xml version="1.0"?> <!-- -*- sgml -*- -->
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.2//EN"
          "http://www.oasis-open.org/docbook/xml/4.2/docbookx.dtd">

<section id="vr-manual.localization" xreflabel="Error localization">
  <title>Debugging and error localization</title>

  <para>
    We describe in this section techniques which can help determining the origin of numerical errors
    in the source code of the analyzed program.
  </para>

  <section id="vr-manual.localization.dd" xreflabel="Delta-Debugging">
    <title>Delta-debugging with the <command>verrou_dd_sym</command> and <command>verrou_dd_line</command> commands</title>

    <para>
      The first technique builds upon Verrou's <xref linkend="vr-manual.feat.exclude"/> feature in
      order to perform a search of functions and source code lines whose perturbation produces the
      most important errors in final results. The idea is the following:
      <itemizedlist>
        <listitem><simpara>First, a complete list of all symbols (which contain perturbated
	floating point instructions) is generated. It is expected that
        perturbing all functions in this list will produce inexact results. On the other hand,
        excluding all symbols from the scope of perturbations should produce unperturbed
        results.</simpara></listitem>
        <listitem><simpara>By splitting the symbols list in two parts, and perturbing each half
        separately, it is possible to determine whether each perturbed half produces inexact
        results.</simpara></listitem>
        <listitem><simpara>Going on like this and performing a bisection of the list of symbols, the
        algorithm eventually finds a subset of functions whose only perturbation is enough to
        produce inexact results.</simpara></listitem>
        <listitem><simpara>The same process can be iterated over all source code lines belonging to
        the identified unstable symbols (provided that the binary embeds debugging
        information).</simpara></listitem>
      </itemizedlist>
    </para>

    <para>
      This algorithm is called <emphasis>Delta-Debugging</emphasis>.
      <!-- , and is for example used in <command>git bisect</command>. -->
      It is automated by the <command>verrou_dd_sym</command> and <command>verrou_dd_line</command> command,
      which can be used in the following way:
    </para>

    <simplesect>
      <title>Synopsis</title>

      <screen><cmdsynopsis id="vr-manual.verrou_dd_sym.synopsis">
        <command>verrou_dd_sym [options]</command>
        <arg choice="req"><replaceable>/path/to/run_script</replaceable></arg>
        <arg choice="req"><replaceable>/path/to/cmp_script</replaceable></arg>
      </cmdsynopsis></screen>

      <screen><cmdsynopsis id="vr-manual.verrou_dd_line.synopsis">
        <command>verrou_dd_line [options]</command>
        <arg choice="req"><replaceable>/path/to/run_script</replaceable></arg>
        <arg choice="req"><replaceable>/path/to/cmp_script</replaceable></arg>
      </cmdsynopsis></screen>

    </simplesect>
    <simplesect>
      <title>Description</title>
      <para>
	<command> verrou_dd_sym </command> is dedicated to search instable symbols (it corresponds more or less to code function).
	Whereas <command> verrou_dd_sym </command> is dedicated to search instable lines for code compiled with debugging symbols (with -g option).
      </para>

      <para id="vr-manual.verrou_dd.desc">
        Arguments passed to <command>verrou_dd_sym</command> or <command>verrou_dd_line</command> are scripts.
	These scripts will be called during the delta-debugging process to automate
        the tasks of running your program under Verrou, and verifying the results. The scripts will
        be called with the following arguments:

        <variablelist>
          <varlistentry>
            <term>
              <command><replaceable>run_script</replaceable></command>
              <arg choice="req"><replaceable>dir</replaceable></arg>
            </term>
            <listitem><para> Should run your program under Verrou, and put the results somewhere
            under the <replaceable>dir</replaceable> directory. A minimal example could look like
            the following:</para>
            <programlisting>
#!/bin/bash
DIR="$1"
valgrind --tool=verrou --rounding-mode=random <replaceable>program args</replaceable> &gt; ${DIR}/results.dat</programlisting>
            </listitem>
          </varlistentry>
          <varlistentry>
            <term>
              <command><replaceable>cmp_script</replaceable></command>
              <arg choice="req"><replaceable>ref_dir</replaceable></arg>
              <arg choice="req"><replaceable>run_dir</replaceable></arg>
            </term>
            <listitem>
              <simpara>
                Should check whether program results in <replaceable>run_dir</replaceable> (as
                stored by a previous call to
                <command><replaceable>run_script</replaceable></command>) are "valid". The precise
                meaning of "valid" is left for the user to determine, depending on the program being
                analyzed. If a comparison to reference results is needed, directory
                <replaceable>ref_dir</replaceable> contains the results produced by an
                uninstrumented run of the
                program. <command><replaceable>cmp_script</replaceable></command> should return 0 if
                and only if the results are "valid".
              </simpara>
              <simpara>
                A minimal example could look like the following:
              </simpara>
              <programlisting>
#!/bin/bash
REF="$1"
RUN="$2"
diff ${REF}/results.dat ${RUN}/results.dat</programlisting>
            </listitem>
          </varlistentry>
        </variablelist>
      </para>
    </simplesect>

    <simplesect>
      <title>Options and environment variables</title>

      <para>
        The following options or environment variables affect the behaviour of <command>verrou_dd_sym</command> and <command>verrou_dd_line</command>:
      </para>

      <variablelist id="vr-manual.verrou_dd.envvars">
        <varlistentry>
          <term>
            <computeroutput>--nruns</computeroutput> or <computeroutput>VERROU_DD_NRUNS</computeroutput>
          </term>
          <listitem>
            <para>An integer setting the required number successful runs needed to consider a
            configuration as stable. If this environment variable is not set, the default value is
            5.</para>
          </listitem>
        </varlistentry>


	<varlistentry>
          <term>
             <computeroutput>--num-threads</computeroutput> or <computeroutput>VERROU_DD_NUM_THREADS</computeroutput>
          </term>
          <listitem>
            <para> Allows to perform <computeroutput>VERROU_DD_NUM_THREADS</computeroutput> runs in parallel.
	     If this environment variable is not set, the parallelism is not activated.
	    </para>
          </listitem>
        </varlistentry>

	<varlistentry>
          <term>
             <computeroutput>--res-with-all-samples </computeroutput> or <computeroutput>VERROU_DD_RES_WITH_ALL_SAMPLES</computeroutput>
          </term>
          <listitem>
            <para> Disable the early exit for result directories. It is useful to compute estimator for all
	    <computeroutput>ddmin*</computeroutput> directories with the same number of samples and hence
	    to sort them.
	    </para>
          </listitem>
        </varlistentry>

	<varlistentry>
          <term>
            <computeroutput>--algo=</computeroutput> or <computeroutput>VERROU_DD_ALGO</computeroutput>
          </term>
          <listitem>
            <para>
	      Option to choose one of the two Delta-Debugging algorithms (<computeroutput>ddmax</computeroutput> and <computeroutput>rddmin</computeroutput>).
	    </para>
	    <para>
	      <computeroutput>rddmin</computeroutput>: return recursively the min-set of unstable
	      symbols.
	    </para>
	    <para>
	      <computeroutput>ddmax</computeroutput>: return the max-set of stable symbols (or lines).
	    </para>

	    <para>
	    If this environment variable is not set, the default value is set to <computeroutput>rddmin</computeroutput>.
	    </para>
          </listitem>
        </varlistentry>

	<varlistentry>
          <term>
            <computeroutput>--rddmin=</computeroutput> or <computeroutput>VERROU_DD_RDDMIN</computeroutput>
          </term>
          <listitem>
            <para>
	      Option to choose one of the variant of rddmin algorithms.
	    </para>
	    <para>
	      "", <computeroutput>strict</computeroutput>: rddmin algorithm with constant number of samples
	    </para>
	    <para>
	      <computeroutput>s</computeroutput>, <computeroutput>stoch</computeroutput>: rddmin algorithm with increasing number of samples (called srddmin)
	    </para>
	    <para>
	      <computeroutput>d</computeroutput>, <computeroutput>dicho</computeroutput>: srddmin algorithm pre-filtered by a dichotomy method (called drddmin)
	    </para>

	    <para>
	    The default value is set to <computeroutput>dicho</computeroutput>.
	    </para>
          </listitem>
        </varlistentry>


	<varlistentry>
          <term>
            <computeroutput>--rddmin-tab=</computeroutput> or <computeroutput>VERROU_DD_RDDMIN_TAB</computeroutput>
          </term>
          <listitem>
            <para>
	      Option to choose the evolution of the number of samples used by the srddmin algorithm.
	    </para>
	    <para>
	      <computeroutput>exp</computeroutput>: increases the number of samples from 1 to
	      <computeroutput>VERROU_DD_NRUNS</computeroutput> with exponential rate.
	    </para>
	    <para>
	      <computeroutput>all</computeroutput>: consecutively try all numbers of samples from 1
	      to <computeroutput>VERROU_DD_NRUNS</computeroutput>.
	    </para>
	    <para>
	      <computeroutput>single</computeroutput>: directly use the number of samples given by
	      <computeroutput>VERROU_DD_NRUNS</computeroutput>. srddmin is equivalent to rddmin in
              this case.
	    </para>

	    <para>
	    The default value is set to <computeroutput>exp</computeroutput>.
	    </para>
          </listitem>
        </varlistentry>

	<varlistentry>
          <term>
	    <computeroutput>--dicho-tab=</computeroutput> or <computeroutput>VERROU_DD_DICHO_TAB</computeroutput>
          </term>
          <listitem>
            <para>
	      Option to choose the evolution of the number of samples used by the
              binary search in the first part of the drddmin algorithm.
	    </para>
	    <para>
	      <computeroutput>exp</computeroutput>: increases the number of samples from 1 to
	      <computeroutput>VERROU_DD_NRUNS</computeroutput> with exponential rate.
	    </para>
	    <para>
	      <computeroutput>all</computeroutput>: consecutively try all numbers of samples from 1
	      to <computeroutput>VERROU_DD_NRUNS</computeroutput>.
	    </para>
	    <para>
	      <computeroutput>single</computeroutput>: use the number of samples given by
	      <computeroutput>VERROU_DD_NRUNS</computeroutput>.
	    </para>
	    <para>
	      <computeroutput>half</computeroutput>: use half the number of samples given by
	      <computeroutput>VERROU_DD_NRUNS</computeroutput>.
	    </para>
	    <para>
	      <replaceable>N</replaceable>: user-provided value (must be an integer 
	      between 1 and <computeroutput>VERROU_DD_NRUNS</computeroutput>).
	    </para>

	    <para>
	    The default value is set to <computeroutput>half</computeroutput>.
	    </para>
          </listitem>
        </varlistentry>

	<varlistentry>
	  <term>
            <computeroutput>--dicho-granularity=</computeroutput> or <computeroutput>VERROU_DD_DICHO_GRANULARITY</computeroutput>
          </term>
        <listitem>
            <para>
	      Option to choose the granularity of the splitFunction of the dichotomy algorithm (used by drddmin).
	    </para>
	    <para>
	    The default value is set to 2. Higher value may help parallelism.
	    </para>
          </listitem>
        </varlistentry>

	<varlistentry>
	  <term>
            <computeroutput>--quiet</computeroutput> or <computeroutput>VERROU_DD_QUIET</computeroutput>
          </term>
        <listitem>
            <para>
	      Option to reduce the verbosity of <command>verrou_dd_sym</command> or <command>verrou_dd_line</command>.
	    </para>
          </listitem>
        </varlistentry>


	<varlistentry>
          <term>
	    <computeroutput>--cache=</computeroutput> or <computeroutput>VERROU_DD_CACHE</computeroutput>
          </term>
          <listitem>
            <para>
	      Option to choose the policy with the existing cache <computeroutput>dd.sym</computeroutput> or <computeroutput>dd.line</computeroutput>
	    </para>
	    <para>
	      <computeroutput>clean</computeroutput>: the previous cache is removed (after reading required information for <computeroutput>--rddmin-heuristics-cache</computeroutput>).
	    </para>
	    <para>
	      <computeroutput>rename</computeroutput>: the previous cache is renamed with time information (time of last symlink creation).
	    </para>
	    <para>
	      <computeroutput>rename_keep_result</computeroutput>: the previous cache is renamed and all configurations not pinpointed by symlink are removed.
	      This option is a compromised between disk usage and the opportunity to used the <computeroutput>--rddmin-heuristics-cache=</computeroutput> option.
	    </para>
	    <para>
	      <computeroutput>keep-run</computeroutput>: the previous cache is kept but the <computeroutput>cmp_script</computeroutput> is run again. Useful when
	      only the <computeroutput>cmp_script</computeroutput> is modified.
	    </para>
	    <para>
	      <computeroutput>continue</computeroutput>: the previous cache is kept for all computation. This option is really useful after manual cache modification to recover computation after
	      error such as <computeroutput>No space left on device</computeroutput> or <computeroutput>job timeout</computeroutput>.
	    </para>

	    <para>
	    The default value is set to <computeroutput>continue</computeroutput> (will probably change soon).
	    </para>
          </listitem>
        </varlistentry>


	<varlistentry>
	  <term>
	    <computeroutput>--rddmin-heuristics-cache=</computeroutput> or <computeroutput>VERROU_DD_RDDMIN_HEURISTICS_CACHE</computeroutput>
          </term>
          <listitem>
            <para>
	      Option to choose the policy with cache to use to prefiltered the rddmin algorithm by previous ddmin results.
	    </para>
	    <para>
	      <computeroutput>none</computeroutput>: the current cache and old cache directory are not used.
	    </para>
	    <para>
	      <computeroutput>cache</computeroutput>: only the current cache directory is used.
	    </para>
	    <para>
	      <computeroutput>all_cache</computeroutput>: the current and old cache directories are used. The old cache directories come from previous run with <computeroutput>rename</computeroutput> or <computeroutput>rename_keep_result</computeroutput> values for <computeroutput>--cache=</computeroutput> option.
	    </para>

	    <para>
	    The default value is set to <computeroutput>none</computeroutput>.
	    </para>
          </listitem>
        </varlistentry>

	<varlistentry>
	  <term>
	    <computeroutput>--rddmin-heuristics-rep=</computeroutput> or <computeroutput>VERROU_DD_RDDMIN_HEURISTICS_REP</computeroutput>
          </term>
          <listitem>
            <para>
	      Option to choose the directory used to prefiltered the rddmin algorithm by previous ddmin results. Could be used several times (with option but not with environment variable). Usually
	      useful after a manual cache renaming.
	    </para>
          </listitem>
        </varlistentry>

	<varlistentry>
	  <term>
	    <computeroutput>--rddmin-heuristics-line-conv</computeroutput> or <computeroutput>VERROU_DD_RDDMIN_HEURISTICS_LINE_CONV</computeroutput>
          </term>
          <listitem>
            <para>
	      Option to shift the line number of the line heuristics. The shift is computed thanks a diff between reference computations. This option is useful
	      for a new delta debug with the same test case and few code modifications.
	    </para>
          </listitem>
        </varlistentry>


      </variablelist>
    </simplesect>

    <simplesect>
      <title>Results *rddmin </title>
      <para id="vr-manual.verrou_dd.results-rddmin">
        <command>verrou_dd_sym</command> (resp. <command>verrou_dd_line</command>) stores many intermediate results within the
        <computeroutput>dd.sym</computeroutput> (resp. <computeroutput>dd.line</computeroutput>) directory. Synthetic results are present in the form
        of symbolic links named after the pattern: <computeroutput>ddmin-<replaceable>N</replaceable></computeroutput>.
      </para>
      <para>
	The list of all symbols (resp. lines) found to be unstable in the
	<computeroutput>ddmin-<replaceable>N</replaceable></computeroutput> set can be retrieved in
	the file: <computeroutput>ddmin-<replaceable>N</replaceable>/dd.include</computeroutput>.
      </para>
      <para>
	The symbolic link <computeroutput>rddmin-cmp</computeroutput>  pinpoints the configuration which is the complement of the union of all ddmin configuration. This successful
	configuration terminates the rddmin algorithm.
      </para>
      <para>
	For debug purpose there are one symbolic link (<computeroutput>FullPerturbation</computeroutput>) to pinpoint the configuration (which should fail) with all symbols (resp. lines) perturbed and another (<computeroutput>NoPerturbation</computeroutput>) to pinpoint the configuration without any perturbation (should be a successful configuration).
      </para>

    </simplesect>

    <simplesect>
      <title>Results ddmax</title>
      <para id="vr-manual.verrou_dd.results">
        <command>verrou_dd_sym</command> (resp. <command>verrou_dd_line</command>) stores many intermediate results within the
        <computeroutput>dd.sym</computeroutput> (resp. <computeroutput>dd.line</computeroutput>)
        directories. The ddmax configuration is pinpointed by a symbolic link (<computeroutput>ddmax</computeroutput>).	

	<!-- Synthetic results are present in the form of symbolic links named in the -->
        <!-- following way: -->
        <!-- <variablelist> -->
        <!--   <varlistentry> -->
        <!--       <term>dd.sym.<replaceable>SYMNAME</replaceable></term> -->
        <!--       <listitem><simpara>The presence of such a symbolic link indicates that the function -->
        <!--       associated to symbol <replaceable>SYMNAME</replaceable> has been detected as -->
        <!--       unstable. When the <option><xref linkend="opt.demangle"/>=no</option> option was -->
        <!--       provided in the verrou command line in -->
        <!--       <command><replaceable>run_script</replaceable></command>, -->
        <!--       <replaceable>SYMNAME</replaceable> is in mangled form. In this case, the -->
        <!--       human-readable name of the function can be retrieved using -->
        <!--       <command>c++filt</command>.</simpara></listitem> -->
        <!--   </varlistentry> -->
        <!--   <varlistentry> -->
        <!--     <term>dd.sym.<replaceable>FILENAME</replaceable>:<replaceable>LINENO</replaceable></term> -->
        <!--     <listitem><simpara>Such a symbolic link indicates that an instability was found in line -->
        <!--     <replaceable>LINENO</replaceable> of file -->
        <!--     <replaceable>FILENAME</replaceable>.</simpara></listitem> -->
        <!--   </varlistentry> -->
        <!-- </variablelist> -->
      </para>
    </simplesect>

  </section>

    <section id="vr-manual.localization.coverage" xreflabel="Coverage">
    <title>Code coverage comparison</title>
    <para>
      The first technique to localize unstable tests, is based on the compatibility with instrumentation provided by the compilers.
      The idea is to produce with compiler tools (option <computeroutput>--coverage</computeroutput> and tool <computeroutput>gcov</computeroutput> for <computeroutput>gcc</computeroutput>) two code coverage for the analyzed test case.
      The first one can be generate without verrou or with <computeroutput>nearest</computeroutput> rounding mode and the second one with <computeroutput>random</computeroutput> rounding mode. The second one can be produced several time, to
      get a coverage with sufficient discrepancie compared to the one with  <computeroutput>nearest</computeroutput> rounding mode. Once both code coverage generated, simple graphical tools
      as <computeroutput>meld</computeroutput> or <computeroutput>kompare</computeroutput> can be used to pinpoint potential unstable test.
    </para>
    </section>

    <section id="vr-manual.localization.CovBB" xreflabel="CovBB">
      <title>Basic Block coverage comparison</title>
      <para>
	The second technique to localize unstable tests, is based on Basic Block (BB) Coverage provided by verrou. The idea behind this technique is the same as behind code coverage comparison except in the way to produce the coverage.
	First it is required to specify which part of the code to trace (instrument BB coverage), with a file format similar to symbols exclusion file. To instrument only the binary without library the following script can be used :
	<programlisting>
	 echo "*" ‘readlink -f <replaceable>program</replaceable>‘ > trace.inc
	</programlisting>

	With the <computeroutput> trace.inc</computeroutput> the BB coverage instrumenttion can be activated with the <computeroutput>--trace=</computeroutput> option :
	<programlisting>
	  valgrind --tool=verrou --rounding-mode=random --trace=trace.inc <replaceable>program args</replaceable>
	</programlisting>

	Hence two files <computeroutput>trace_bb_cov.log-PID</computeroutput> and <computeroutput>trace_bb_info.log-PID</computeroutput> are generated.
	The first one contains counter information for each Basic Blocks and the second one contains debug information for each Basic Bloc. These two files (which must be moved together)
	can be post-treated to be as readable as possible with the <computeroutput>genCovBB</computeroutput> command.
	<programlisting>
	genCovBB trace_bb_cov.log-*
	</programlisting>

	The differences between generated coverage  are more difficult to analyze compared to the ones generated by code coverage tools, because the code structure is lost. Nevertheless
	it is easier to generate  and can produced really powerful
	information if used with the client request <computeroutput>VERROU_DUMP_COVER</computeroutput> to recover partially time information lost by coverage techniques.

      </para>
    </section>

    <section id="vr-manual.localization.post" xreflabel="Post_verrou_dd">
      <title> post_verrou_dd</title>
    <simplesect>
   <title>Synopsis</title>

      <screen><cmdsynopsis id="vr-manual.post_verrou_dd.synopsis">
        <command>post_verrou_dd [options]</command>
        <arg choice="req"><replaceable>/path/to/run_script</replaceable></arg>
        <arg choice="req"><replaceable>/path/to/cmp_script</replaceable></arg>
      </cmdsynopsis></screen>

    </simplesect>

    <simplesect>
      <title>Description</title>
      <para>
	The tool <command>post_verrou_dd</command> enables to post-treat the result repository obtained by <command>verrou_dd_*</command> commands.
	The post-treatment consists to run for each selected ddmin configuration new runs with modified (or not) configurations (rounding mode, instruction types).
	For each run it is possible to activate the Basic Bloc coverage generation.
      </para>

      <para>
	The scripts <command> run_script </command> and <command> cmp_script </command> are the same parameters of the <command>verrou_dd_line</command> command.
      </para>
    </simplesect>

    <simplesect>
      <title>Options and environment variables</title>

      <variablelist id="vr-manual.post_verrou_dd.envvars">
        <varlistentry>
          <term>
            <computeroutput>--nruns=</computeroutput> or <computeroutput>VERROU_POST_NRUNS</computeroutput>
          </term>
          <listitem>
            <para>An integer setting the run number of each configuration. If this variable is not set, the default value is
            5.</para>
          </listitem>
	</varlistentry>

	<varlistentry>
          <term>
             <computeroutput>--num-threads=</computeroutput> or <computeroutput>VERROU_POST_NUM_THREADS</computeroutput>
          </term>
          <listitem>
            <para> Allows to perform <computeroutput>VERROU_POST_NUM_THREADS</computeroutput> runs in parallel.
	    If this variable is not set, the parallelism is not activated.
	    To use this option <command> run_script </command> has to be thread safe.
	    </para>
          </listitem>
        </varlistentry>

	<varlistentry>
          <term>
             <computeroutput>--rep=</computeroutput> or <computeroutput>VERROU_POST_REP</computeroutput>
          </term>
          <listitem>
            <para>
	      Set the cache repository to find the default configuration.
	      If this variable is not set, its value is  <computeroutput>dd.line</computeroutput>
	    </para>
          </listitem>
        </varlistentry>


	<varlistentry>
          <term>
             <computeroutput>--configuration=</computeroutput> or <computeroutput>--sub-rep=</computeroutput> or <computeroutput>VERROU_POST_CONFIGURATION</computeroutput>
          </term>

          <listitem>
	  <para>
	    The option can be called several times to generate a list of configuration. By default the list contains
	    <computeroutput>$VERROU_POST_REP/ddmin*</computeroutput> , <computeroutput>$VERROU_POST_REP/rddmin-cmp</computeroutput> and <computeroutput>$VERROU_POST_REP/ref</computeroutput>. Each element of the list has to be generated by
	    the verrou_dd and so the directory <computeroutput>../ref</computeroutput> has to exist.
	  </para>
	  </listitem>
        </varlistentry>

	<varlistentry>
          <term>
             <computeroutput>--instr</computeroutput> or <computeroutput>VERROU_POST_INSTR</computeroutput>.
	  </term>
	  <listitem>
	    <para>
	     The option can be called several times to generate a list of instruction type configuration.
	    A configuration is a coma separated list of the following items :
	    <computeroutput>add</computeroutput>,
	    <computeroutput>sub</computeroutput>,
	    <computeroutput>mul</computeroutput>,
	    <computeroutput>div</computeroutput>,
	    <computeroutput>madd</computeroutput>,
	    <computeroutput>msub</computeroutput>,
	    <computeroutput>conv</computeroutput>.
	    </para>
	    </listitem>
        </varlistentry>

	<varlistentry>
          <term>
             <computeroutput>--rounding=</computeroutput> or <computeroutput>--rounding-mode=</computeroutput> or <computeroutput>VERROU_POST_ROUNDING</computeroutput>.
	     The option can be called several times to generate a list of rounding mode (
	     <computeroutput>random[_det|_comdet]</computeroutput>,
	     <computeroutput>prandom[_det|_comdet]</computeroutput>,
	     <computeroutput>average[_det|_comdet]</computeroutput>,
	     <computeroutput>upward</computeroutput>,
	     <computeroutput>downward</computeroutput>,
	     <computeroutput>farthest</computeroutput>,
	     <computeroutput>toward_zero</computeroutput>
	     )
          </term>
          <listitem>

	    <para>
	      <computeroutput>all_det</computeroutput> corresponds to the list :
	      [<computeroutput>upward </computeroutput>,
	      <computeroutput>downward</computeroutput>,
	      <computeroutput>farthest</computeroutput>,
	      <computeroutput>toward_zero</computeroutput>,
	      <computeroutput>nearest</computeroutput>]
	    </para>
	    <para>
	      <computeroutput>no_det</computeroutput> corresponds to the list :
	      [<computeroutput>average</computeroutput>,
	      <computeroutput>random</computeroutput>, <computeroutput>prandom</computeroutput>]
	    </para>
          </listitem>
        </varlistentry>

	<varlistentry>
          <term>
            <computeroutput>--trace-bin</computeroutput> or <computeroutput>VERROU_POST_TRACE_BIN</computeroutput>
          </term>
          <listitem>
            <para>
	      Activate the BB coverage trace generation. The verrou trace file is automatically generated with the binary
	      object (without library). If the trace file
	      is not the one expected, the option <computeroutput>--trace-file=</computeroutput> has to be used.
	    </para>
          </listitem>
        </varlistentry>

	<varlistentry>
          <term>
            <computeroutput>--trace-pattern=</computeroutput> or <computeroutput>VERROU_POST_TRACE_PATTERN</computeroutput>
          </term>
          <listitem>
            <para>
	      Activate the BB coverage trace generation. The verrou trace file is automatically generated thanks pattern (* and ?). If the trace file
	      is not the one expected, the option <computeroutput>--trace-file=</computeroutput> has to be used.
	      This option is compatible with <computeroutput>--trace-bin=</computeroutput>. This option can be called several times.
	    </para>
          </listitem>
        </varlistentry>

	<varlistentry>
          <term>
            <computeroutput>--trace-file=</computeroutput> or <computeroutput>VERROU_POST_TRACE_FILE</computeroutput>
          </term>
          <listitem>
            <para>
	      Activate the BB coverage trace generation. The user has to provide  directly a specific trace-file (See Verrou format). This option is incompatible with  
	      <computeroutput>--trace-bin</computeroutput> and <computeroutput>--trace-pattern=</computeroutput>. This option
	      is less convenient than the two previous one but may be required for few corner cases.
	    </para>
          </listitem>
        </varlistentry>

      </variablelist>

    </simplesect>

    </section>
    <section id="vr-manual.plotstat" xreflabel="ploStat">
      <title> verrou_plot_stat</title>
    <simplesect>
   <title>Synopsis</title>

      <screen><cmdsynopsis id="vr-manual.plotstat.synopsis">
        <command>verrou_plot_stat [options] [/path/to/run_script]</command>
        <arg choice="req"><replaceable>/path/to/extract_script</replaceable></arg>
      </cmdsynopsis></screen>

    </simplesect>

    <simplesect>
      <title>Description</title>
      <para>
	The tool <command>verrou_plot_stat</command> enables to visualize the histogram
	of the result (extracted with <command> extract_script</command>) of a code run under verrou and to compute the non-gaussian error estimator.
      </para>

      <screen>
refValue[nearest] : 1.05891843750000000e+05
estimator	abs	rel	rel(in bit)
average:	1.034992e+03	9.7741e-03	6.68bit
average_det:	1.036070e+03	9.7842e-03	6.68bit
random:	1.983109e+03	1.8728e-02	5.74bit
random_det:	1.985172e+03	1.8747e-02	5.74bit
all:	4.337773e+03	4.0964e-02	4.61bit
      </screen>
      <para>

	<itemizedlist>

          <listitem><simpara> The abs estimator is $max_i(|X_i-X_ref|$ .</simpara></listitem>
	  <listitem><simpara> The rel estimator is max_i(|X_i-X_ref|)/|X_ref| </simpara></listitem>
          <listitem><simpara> The binary rel estimator is -log2(max_i(|X_i-X_ref|)/|X_ref|)</simpara></listitem>
          <listitem><simpara>  <computeroutput>all </computeroutput> means the i samples take into account all the sample of previous rounding mode and all determinist computed rounding mode</simpara></listitem>

	</itemizedlist>
      </para>

      <para>
	The scripts <command> run_script </command> is similar to the one of <command>verrou_dd_line</command> command. This script is optional if the computation are already done (by exemple with
	a previous call to <command>verrou_plot_stat</command> or <command>post_verrou_dd</command>).

	The script <command> extract_script </command> has only one parameter (the repository of computation : the same parameter of <command>run_script</command>). It has to print
	the extracted value on the first line of the standard output.

	To study several output variables the command can be called several time the command with different <command>extract_script </command>. Thanks the cache repository (by default <computeroutput>verrou.stat</computeroutput>) the run commands won't be rerun.
      </para>
    </simplesect>

    <simplesect>
      <title>Options</title>

      <variablelist id="vr-manual.plotStat.envvars">
	<varlistentry>
          <term>
            <computeroutput>--help=</computeroutput> or <computeroutput>-h</computeroutput>
          </term>
          <listitem>
            <para>
	      Print help.
	    </para>
          </listitem>
	</varlistentry>

	<varlistentry>
          <term>
            <computeroutput>--rep=DIR</computeroutput> or <computeroutput>-r DIR</computeroutput>
          </term>
          <listitem>
            <para>
	      Set the repository to store/read computation. By default <computeroutput>DIR</computeroutput> is set
	      to <computeroutput>verrou.stat</computeroutput>. If the option <computeroutput>--specific-pattern</computeroutput> is used
	      the default is set to <computeroutput>./</computeroutput>.
	    </para>
          </listitem>
	</varlistentry>

	<varlistentry>
          <term>
            <computeroutput>--samples=</computeroutput> or <computeroutput>-s</computeroutput>
          </term>
          <listitem>
            <para>An integer setting the run number of random and average distribution. If this variable is not set, the default value is
              100. -1 means the highest number without running additional computation.</para>
          </listitem>
	</varlistentry>

	<varlistentry>
          <term>
            <computeroutput>--num-threads=</computeroutput>
          </term>
          <listitem>
            <para>An integer setting the run number of threads to run code thanks <command> run_script </command>.  Default is sequential computation.
	      To use this option <command> run_script </command> has to be thread safe.
	    </para>
          </listitem>
	</varlistentry>

	<varlistentry>
          <term>
            <computeroutput>--rounding-list=</computeroutput>
          </term>
          <listitem>
            <para> A coma separated list of rounding mode. The list can contain
	     <computeroutput>random[_det|_comdet]</computeroutput>,
	     <computeroutput>prandom[_det|_comdet]</computeroutput>,
	     <computeroutput>average[_det|_comdet]</computeroutput>,
	     <computeroutput>upward</computeroutput>,
	     <computeroutput>downward</computeroutput>,
	     <computeroutput>farthest</computeroutput>,
	     <computeroutput>toward_zero</computeroutput>
	    </para>
          </listitem>
	  <listitem>
            <para> <computeroutput>nodet</computeroutput> is an alias to <computeroutput>average,random</computeroutput>.
	    </para>
	    <para> <computeroutput>det</computeroutput> is an alias to <computeroutput>nearest,upward,downward,toward_zero,farthest</computeroutput>.
	    </para>
          </listitem>
	  <listitem>
	    <para> The list can also contain <computeroutput>prandom_fun</computeroutput>. This rounding mode corresponds to <computeroutput>prandom</computeroutput> with the <xref linkend="vr-manual.feat.updatepfunc"/> set to <computeroutput>func</computeroutput>.
	    </para>
	  </listitem>
	  <listitem>
	    <para> The list can also contain <computeroutput>prandom_FLOAT</computeroutput> with <computeroutput>FLOAT</computeroutput> a floating point number between 0 and 1. This rounding mode corresponds to <computeroutput>prandom</computeroutput> with the  <xref linkend="vr-manual.feat.updatepvalue"/>  set to <computeroutput>FLOAT</computeroutput>.
	    </para>
	  </listitem>
	</varlistentry>

	<varlistentry>
          <term>
            <computeroutput>--montecarlo</computeroutput> or <computeroutput>-m</computeroutput>
          </term>
          <listitem>
            <para> If this option is set, the deterministic mode use also the number of sample defined by <computeroutput>--samples=</computeroutput>.
	    </para>
          </listitem>
	</varlistentry>

	<varlistentry>
          <term>
            <computeroutput>--png=FILE</computeroutput> or <computeroutput>-p FILE</computeroutput>
          </term>
          <listitem>
            <para> Defined the output file for histogram. By default the plot is interactive.
	    </para>
          </listitem>
	</varlistentry>

	<varlistentry>
          <term>
            <computeroutput>--nb-bin=VALUE</computeroutput>
          </term>
          <listitem>
            <para>
	      Set the number of histogram bins to VALUE. The default value is 40.
	    </para>
          </listitem>
	</varlistentry>

	<varlistentry>
          <term>
            <computeroutput>--no-plot</computeroutput>
          </term>
          <listitem>
            <para>
	      Do not plot histogram. Only the error estimators are computed.
	    </para>
          </listitem>
	</varlistentry>
	<varlistentry>
          <term>
            <computeroutput>--run-only</computeroutput>
          </term>
          <listitem>
            <para>
	      Neither  plot the  histogram nor compute the error estimators.
	    </para>
          </listitem>
	</varlistentry>

	<varlistentry>
          <term>
            <computeroutput>--relative=VALUE</computeroutput> or <computeroutput>-r VALUE</computeroutput>
          </term>
          <listitem>
            <para> With this option the abscissa is relative. The reference (defined by VALUE) is either a numerical value
	      or a key to a rounding mode (nearest, upward, ...)
	    </para>
          </listitem>
	</varlistentry>

	<varlistentry>
          <term>
            <computeroutput>--ref=VALUE</computeroutput>
          </term>
          <listitem>
            <para> This option is used to defined the reference used to compute accuracy estimator. The VALUE is key to a rounding mode (nearest, upward, ...). If the rounding mode is not determinist, the average value is taken.
	    </para>
          </listitem>
	</varlistentry>

	<varlistentry>
          <term>
            <computeroutput>--continue-on-extract-value-error</computeroutput>
          </term>
          <listitem>
            <para> This option is used to be able to plot and compute estimator even if few samples produce an execution error. If errors occur the plot and the stat indicate the failure rate. This option is not activated by default, as usually errors come from error in the extract script.
	    </para>
          </listitem>
	</varlistentry>

	<varlistentry>
          <term>
            <computeroutput>--mca=MODE-DBL-FLT</computeroutput>
          </term>
          <listitem>
            <para> Add the MODE-DBL-FLT mca mode to the study. MODE has to be in ["rr","pb","mca"]. DBL is mca noise for double and FLT for float.
	      Typical configuration is  <computeroutput>--mca=rr-53-24</computeroutput>
	    </para>
          </listitem>
	</varlistentry>

	<varlistentry>
          <term>
            <computeroutput>--specific-pattern=</computeroutput>
          </term>
          <listitem>
            <para> This option enables to plot histogram for computation run without the framework or after files renaming.
	      Typical calls  are :
	    </para>
	    <para>
	      <computeroutput>--rep="." --specific-pattern=verrou.stat/random/dd.run* </computeroutput>
	    </para>
	    <para>
	      <computeroutput>--rep="verrou.stat" --specific-pattern=random/dd.run* </computeroutput>
	    </para>
          </listitem>
	</varlistentry>

      </variablelist>

    </simplesect>

    </section>


</section>

<!-- Local Variables: -->
<!-- mode: nxml -->
<!-- fill-column: 100 -->
<!-- End: -->
