<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>9.Â README.android</title>
<link rel="stylesheet" type="text/css" href="vg_basic.css">
<meta name="generator" content="DocBook XSL Stylesheets V1.79.1">
<link rel="home" href="index.html" title="Valgrind Documentation">
<link rel="up" href="dist.html" title="Valgrind Distribution Documents">
<link rel="prev" href="dist.readme-s390.html" title="8.Â README.S390">
<link rel="next" href="dist.readme-android_emulator.html" title="10.Â README.android_emulator">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div><table class="nav" width="100%" cellspacing="3" cellpadding="3" border="0" summary="Navigation header"><tr>
<td width="22px" align="center" valign="middle"><a accesskey="p" href="dist.readme-s390.html"><img src="images/prev.png" width="18" height="21" border="0" alt="Prev"></a></td>
<td width="25px" align="center" valign="middle"><a accesskey="u" href="dist.html"><img src="images/up.png" width="21" height="18" border="0" alt="Up"></a></td>
<td width="31px" align="center" valign="middle"><a accesskey="h" href="index.html"><img src="images/home.png" width="27" height="20" border="0" alt="Up"></a></td>
<th align="center" valign="middle">Valgrind Distribution Documents</th>
<td width="22px" align="center" valign="middle"><a accesskey="n" href="dist.readme-android_emulator.html"><img src="images/next.png" width="18" height="21" border="0" alt="Next"></a></td>
</tr></table></div>
<div class="chapter">
<div class="titlepage"><div><div><h1 class="title">
<a name="dist.readme-android"></a>9.Â README.android</h1></div></div></div>
<div class="literallayout"><p><br>
Â Â Â Â Â Â <br>
HowÂ toÂ cross-compileÂ andÂ runÂ onÂ Android.Â Â PleaseÂ readÂ toÂ theÂ end,<br>
sinceÂ thereÂ areÂ importantÂ detailsÂ furtherÂ downÂ regardingÂ crash<br>
avoidanceÂ andÂ GPUÂ support.<br>
<br>
TheseÂ notesÂ wereÂ lastÂ updatedÂ onÂ 4Â NovÂ 2014,Â forÂ ValgrindÂ SVN<br>
revisionÂ 14689/2987.<br>
<br>
TheseÂ instructionsÂ areÂ knownÂ toÂ work,Â orÂ haveÂ workedÂ atÂ someÂ timeÂ in<br>
theÂ past,Â for:<br>
<br>
arm:<br>
Â Â AndroidÂ 4.0.3Â runningÂ onÂ aÂ (rooted,Â AOSPÂ build)Â NexusÂ S.<br>
Â Â AndroidÂ 4.0.3Â runningÂ onÂ MotorolaÂ Xoom.<br>
Â Â AndroidÂ 4.0.3Â runningÂ onÂ androidÂ armÂ emulator.<br>
Â Â AndroidÂ 4.1Â Â Â runningÂ onÂ androidÂ emulator.<br>
Â Â AndroidÂ 2.3.4Â onÂ NexusÂ SÂ workedÂ atÂ someÂ timeÂ inÂ theÂ past.<br>
<br>
x86:<br>
Â Â AndroidÂ 4.0.3Â runningÂ onÂ androidÂ x86Â emulator.<br>
<br>
mips32:<br>
Â Â AndroidÂ 4.1.2Â runningÂ onÂ androidÂ mipsÂ emulator.<br>
Â Â AndroidÂ 4.2.2Â runningÂ onÂ androidÂ mipsÂ emulator.<br>
Â Â AndroidÂ 4.3Â Â Â runningÂ onÂ androidÂ mipsÂ emulator.<br>
Â Â AndroidÂ 4.0.4Â runningÂ onÂ BROADCOMÂ bcm7425<br>
<br>
arm64:<br>
Â Â AndroidÂ 4.5Â (?)Â runningÂ onÂ ARMÂ Juno<br>
<br>
OnÂ android-arm,Â GDBserverÂ mightÂ insertÂ breaksÂ atÂ wrongÂ addresses.<br>
FeedbackÂ onÂ thisÂ welcome.<br>
<br>
OtherÂ configurationsÂ andÂ toolchainsÂ mightÂ work,Â butÂ haven'tÂ beenÂ tested.<br>
FeedbackÂ isÂ welcome.<br>
<br>
Toolchain:<br>
<br>
Â Â ForÂ arm32,Â x86Â andÂ mips32Â youÂ needÂ theÂ android-ndk-r6Â native<br>
Â Â Â Â developmentÂ kit.Â Â r6bÂ andÂ r7Â giveÂ aÂ non-completely-workingÂ build;<br>
Â Â Â Â seeÂ http://code.google.com/p/android/issues/detail?id=23203<br>
Â Â Â Â ForÂ theÂ androidÂ emulator,Â theÂ versionsÂ neededÂ andÂ howÂ toÂ install<br>
Â Â Â Â themÂ areÂ describedÂ inÂ README.android_emulator.<br>
<br>
Â Â Â Â YouÂ canÂ getÂ android-ndk-r6Â from<br>
Â Â Â Â http://dl.google.com/android/ndk/android-ndk-r6-linux-x86.tar.bz2<br>
<br>
Â Â ForÂ arm64Â (aarch64)Â youÂ needÂ theÂ android-ndk-r10cÂ NDK,Â from<br>
Â Â Â Â http://dl.google.com/android/ndk/android-ndk-r10c-linux-x86_64.bin<br>
<br>
InstallÂ theÂ NDKÂ somewhere.Â Â Doesn'tÂ matterÂ where.Â Â Then:<br>
<br>
<br>
#Â ModifyÂ thisÂ (obviously).Â Â Note,Â thisÂ "export"Â commandÂ isÂ onlyÂ done<br>
#Â soÂ asÂ toÂ reduceÂ theÂ amountÂ ofÂ typingÂ required.Â Â NoneÂ ofÂ theÂ commands<br>
#Â belowÂ readÂ itÂ asÂ partÂ ofÂ theirÂ operation.<br>
#<br>
exportÂ NDKROOT=/path/to/android-ndk-r&lt;version&gt;<br>
<br>
<br>
#Â ThenÂ cdÂ toÂ theÂ rootÂ ofÂ yourÂ ValgrindÂ sourceÂ tree.<br>
#<br>
cdÂ /path/to/valgrind/source/tree<br>
<br>
<br>
#Â AfterÂ thisÂ point,Â youÂ don'tÂ needÂ toÂ modifyÂ anything.Â Â JustÂ copyÂ and<br>
#Â pasteÂ theÂ commandsÂ below.<br>
<br>
<br>
#Â SetÂ upÂ toolchainÂ paths.<br>
#<br>
#Â ForÂ ARM<br>
exportÂ AR=$NDKROOT/toolchains/arm-linux-androideabi-4.4.3/prebuilt/linux-x86/bin/arm-linux-androideabi-ar<br>
exportÂ LD=$NDKROOT/toolchains/arm-linux-androideabi-4.4.3/prebuilt/linux-x86/bin/arm-linux-androideabi-ld<br>
exportÂ CC=$NDKROOT/toolchains/arm-linux-androideabi-4.4.3/prebuilt/linux-x86/bin/arm-linux-androideabi-gcc<br>
<br>
#Â ForÂ x86<br>
exportÂ AR=$NDKROOT/toolchains/x86-4.4.3/prebuilt/linux-x86/bin/i686-android-linux-ar<br>
exportÂ LD=$NDKROOT/toolchains/x86-4.4.3/prebuilt/linux-x86/bin/i686-android-linux-ld<br>
exportÂ CC=$NDKROOT/toolchains/x86-4.4.3/prebuilt/linux-x86/bin/i686-android-linux-gcc<br>
<br>
#Â ForÂ MIPS32<br>
exportÂ AR=$NDKROOT/toolchains/mipsel-linux-android-4.8/prebuilt/linux-x86_64/bin/mipsel-linux-android-ar<br>
exportÂ LD=$NDKROOT/toolchains/mipsel-linux-android-4.8/prebuilt/linux-x86_64/bin/mipsel-linux-android-ld<br>
exportÂ CC=$NDKROOT/toolchains/mipsel-linux-android-4.8/prebuilt/linux-x86_64/bin/mipsel-linux-android-gcc<br>
<br>
#Â ForÂ ARM64Â (AArch64)<br>
exportÂ AR=$NDKROOT/toolchains/aarch64-linux-android-4.9/prebuilt/linux-x86_64/bin/aarch64-linux-android-arÂ <br>
exportÂ LD=$NDKROOT/toolchains/aarch64-linux-android-4.9/prebuilt/linux-x86_64/bin/aarch64-linux-android-ld<br>
exportÂ CC=$NDKROOT/toolchains/aarch64-linux-android-4.9/prebuilt/linux-x86_64/bin/aarch64-linux-android-gcc<br>
<br>
<br>
#Â DoÂ configurationÂ stuff.Â Â Don'tÂ messÂ withÂ theÂ --prefixÂ inÂ the<br>
#Â configureÂ commandÂ below,Â evenÂ ifÂ youÂ thinkÂ it'sÂ wrong.<br>
#Â YouÂ mayÂ needÂ toÂ setÂ theÂ --with-tmpdirÂ pathÂ toÂ something<br>
#Â differentÂ ifÂ /sdcardÂ doesn'tÂ workÂ onÂ theÂ deviceÂ --Â thisÂ is<br>
#Â aÂ knownÂ causeÂ ofÂ difficulties.<br>
<br>
#Â TheÂ belowÂ re-generatesÂ configure,Â Makefiles,Â ...<br>
#Â ThisÂ isÂ notÂ neededÂ ifÂ youÂ startÂ fromÂ aÂ releaseÂ tarball.<br>
./autogen.sh<br>
<br>
#Â forÂ ARM<br>
CPPFLAGS="--sysroot=$NDKROOT/platforms/android-3/arch-arm"Â \<br>
Â Â Â CFLAGS="--sysroot=$NDKROOT/platforms/android-3/arch-arm"Â \<br>
Â Â Â ./configureÂ --prefix=/data/local/InstÂ \<br>
Â Â Â --host=armv7-unknown-linuxÂ --target=armv7-unknown-linuxÂ \<br>
Â Â Â --with-tmpdir=/sdcard<br>
#Â note:Â onÂ androidÂ emulator,Â android-14Â platformÂ wasÂ alsoÂ testedÂ andÂ works.<br>
#Â ItÂ isÂ notÂ clearÂ whatÂ thisÂ platformÂ nrÂ reallyÂ is.<br>
<br>
#Â forÂ x86<br>
CPPFLAGS="--sysroot=$NDKROOT/platforms/android-9/arch-x86"Â \<br>
Â Â Â CFLAGS="--sysroot=$NDKROOT/platforms/android-9/arch-x86Â -fno-pic"Â \<br>
Â Â Â ./configureÂ --prefix=/data/local/InstÂ \<br>
Â Â Â --host=i686-android-linuxÂ --target=i686-android-linuxÂ \<br>
Â Â Â --with-tmpdir=/sdcard<br>
<br>
#Â forÂ MIPS32<br>
CPPFLAGS="--sysroot=$NDKROOT/platforms/android-18/arch-mips"Â \<br>
Â Â Â CFLAGS="--sysroot=$NDKROOT/platforms/android-18/arch-mips"Â \<br>
Â Â Â ./configureÂ --prefix=/data/local/InstÂ \<br>
Â Â Â --host=mipsel-linux-androidÂ --target=mipsel-linux-androidÂ \<br>
Â Â Â --with-tmpdir=/sdcard<br>
<br>
#Â forÂ ARM64Â (AArch64)<br>
CPPFLAGS="--sysroot=$NDKROOT/platforms/android-21/arch-arm64"Â \<br>
Â Â Â CFLAGS="--sysroot=$NDKROOT/platforms/android-21/arch-arm64"Â \<br>
Â Â Â ./configureÂ --prefix=/data/local/InstÂ \<br>
Â Â Â --host=aarch64-unknown-linuxÂ --target=aarch64-unknown-linuxÂ \<br>
Â Â Â --with-tmpdir=/sdcard<br>
<br>
<br>
#Â AtÂ theÂ endÂ ofÂ theÂ configureÂ run,Â aÂ fewÂ linesÂ ofÂ details<br>
#Â areÂ printed.Â Â MakeÂ sureÂ thatÂ youÂ seeÂ theseÂ twoÂ lines:<br>
#<br>
#Â ForÂ ARM:<br>
#Â Â Â Â Â Â Â Â Â Â PlatformÂ variant:Â android<br>
#Â Â Â Â Â PrimaryÂ -DVGPVÂ string:Â -DVGPV_arm_linux_android=1<br>
#<br>
#Â ForÂ x86:<br>
#Â Â Â Â Â Â Â Â Â Â PlatformÂ variant:Â android<br>
#Â Â Â Â Â PrimaryÂ -DVGPVÂ string:Â -DVGPV_x86_linux_android=1<br>
#<br>
#Â ForÂ mips32:<br>
#Â Â Â Â Â Â Â Â Â Â PlatformÂ variant:Â android<br>
#Â Â Â Â Â PrimaryÂ -DVGPVÂ string:Â -DVGPV_mips32_linux_android=1<br>
#<br>
#Â ForÂ ARM64Â (AArch64):<br>
#Â Â Â Â Â Â Â Â Â Â PlatformÂ variant:Â android<br>
#Â Â Â Â Â PrimaryÂ -DVGPVÂ string:Â -DVGPV_arm64_linux_android=1<br>
#<br>
#Â IfÂ youÂ seeÂ anythingÂ elseÂ atÂ thisÂ point,Â somethingÂ isÂ wrong,Â and<br>
#Â eitherÂ theÂ buildÂ willÂ fail,Â orÂ willÂ succeedÂ butÂ you'llÂ getÂ something<br>
#Â whichÂ won'tÂ work.<br>
<br>
<br>
#Â Build,Â andÂ parkÂ theÂ installÂ treeÂ inÂ `pwd`/Inst<br>
#<br>
makeÂ -j4<br>
makeÂ -j4Â installÂ DESTDIR=`pwd`/Inst<br>
<br>
<br>
#Â ToÂ getÂ theÂ installÂ treeÂ ontoÂ theÂ device:<br>
#Â (IÂ don'tÂ knowÂ whyÂ it'sÂ notÂ "adbÂ pushÂ InstÂ /data/local",Â butÂ this<br>
#Â formulationÂ doesÂ appearÂ toÂ putÂ theÂ resultÂ inÂ /data/local/Inst.)<br>
#<br>
adbÂ pushÂ InstÂ /<br>
<br>
<br>
#Â ToÂ runÂ (onÂ theÂ device).Â Â ThereÂ areÂ twoÂ thingsÂ youÂ needÂ toÂ consider:<br>
#<br>
#Â (1)Â ifÂ youÂ areÂ runningÂ onÂ theÂ AndroidÂ emulator,Â ValgrindÂ mayÂ crash<br>
#Â Â Â Â Â atÂ startup.Â Â ThisÂ isÂ becauseÂ theÂ emulatorÂ (forÂ ARM)Â mayÂ notÂ be<br>
#Â Â Â Â Â simulatingÂ aÂ hardwareÂ TLSÂ register.Â Â ToÂ getÂ aroundÂ this,Â run<br>
#Â Â Â Â Â ValgrindÂ with:<br>
#Â Â Â Â Â Â Â --kernel-variant=android-no-hw-tls<br>
#Â <br>
#Â (2)Â ifÂ youÂ areÂ runningÂ aÂ realÂ device,Â youÂ needÂ toÂ tellÂ Valgrind<br>
#Â Â Â Â Â whatÂ GPUÂ itÂ has,Â soÂ ValgrindÂ knowsÂ howÂ toÂ handleÂ customÂ GPU<br>
#Â Â Â Â Â ioctls.Â Â YouÂ canÂ chooseÂ oneÂ ofÂ theÂ following:<br>
#Â Â Â Â Â Â Â --kernel-variant=android-gpu-sgx5xxÂ Â Â Â Â #Â PowerVRÂ SGXÂ 5XXÂ series<br>
#Â Â Â Â Â Â Â --kernel-variant=android-gpu-adreno3xxÂ Â #Â QualcommÂ AdrenoÂ 3XXÂ series<br>
#Â Â Â Â Â IfÂ youÂ don'tÂ chooseÂ one,Â theÂ programÂ willÂ stillÂ run,Â butÂ Memcheck<br>
#Â Â Â Â Â mayÂ reportÂ falseÂ errorsÂ afterÂ theÂ programÂ performsÂ GPU-specificÂ ioctls.<br>
#<br>
#Â Anyway:Â toÂ runÂ onÂ theÂ device:<br>
#<br>
/data/local/Inst/bin/valgrindÂ [kernelÂ variantÂ args]Â [theÂ usualÂ argsÂ etc]<br>
<br>
<br>
#Â OnceÂ you'reÂ upÂ andÂ running,Â aÂ handyÂ modify-V-rebuild-reinstall<br>
#Â commandÂ lineÂ (onÂ theÂ host,Â ofÂ course)Â is<br>
#<br>
mqÂ -j2Â &amp;&amp;Â mqÂ -j2Â installÂ DESTDIR=`pwd`/InstÂ &amp;&amp;Â adbÂ pushÂ InstÂ /<br>
#<br>
#Â whereÂ 'mq'Â isÂ anÂ aliasÂ forÂ 'makeÂ --quiet'.<br>
<br>
<br>
#Â OneÂ commonÂ causeÂ ofÂ runsÂ failingÂ atÂ startupÂ isÂ theÂ inabilityÂ of<br>
#Â ValgrindÂ toÂ findÂ aÂ suitableÂ temporaryÂ directory.Â Â OnÂ theÂ device,<br>
#Â thereÂ doesn'tÂ seemÂ toÂ beÂ anyÂ oneÂ locationÂ whichÂ weÂ alwaysÂ have<br>
#Â permissionÂ toÂ writeÂ to.Â Â TheÂ instructionsÂ aboveÂ useÂ /sdcard.Â Â If<br>
#Â thatÂ doesn'tÂ workÂ forÂ you,Â andÂ you'reÂ ValgrindingÂ oneÂ specific<br>
#Â applicationÂ whichÂ isÂ alreadyÂ installed,Â youÂ couldÂ tryÂ usingÂ its<br>
#Â temporaryÂ directory,Â inÂ /data/data,Â forÂ example<br>
#Â /data/data/org.mozilla.firefox_beta.<br>
#<br>
#Â UsingÂ /system/bin/logcatÂ onÂ theÂ deviceÂ isÂ helpfulÂ forÂ diagnosing<br>
#Â theseÂ kindsÂ ofÂ problems.<br>
<br>
Â Â Â Â </p></div>
</div>
<div>
<br><table class="nav" width="100%" cellspacing="3" cellpadding="2" border="0" summary="Navigation footer">
<tr>
<td rowspan="2" width="40%" align="left">
<a accesskey="p" href="dist.readme-s390.html">&lt;&lt;Â 8.Â README.S390</a>Â </td>
<td width="20%" align="center"><a accesskey="u" href="dist.html">Up</a></td>
<td rowspan="2" width="40%" align="right">Â <a accesskey="n" href="dist.readme-android_emulator.html">10.Â README.android_emulatorÂ &gt;&gt;</a>
</td>
</tr>
<tr><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td></tr>
</table>
</div>
</body>
</html>
