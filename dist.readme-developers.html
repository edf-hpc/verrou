<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>6.Â README_DEVELOPERS</title>
<link rel="stylesheet" type="text/css" href="vg_basic.css">
<meta name="generator" content="DocBook XSL Stylesheets V1.79.1">
<link rel="home" href="index.html" title="Valgrind Documentation">
<link rel="up" href="dist.html" title="Valgrind Distribution Documents">
<link rel="prev" href="dist.readme-missing.html" title="5.Â README_MISSING_SYSCALL_OR_IOCTL">
<link rel="next" href="dist.readme-packagers.html" title="7.Â README_PACKAGERS">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div><table class="nav" width="100%" cellspacing="3" cellpadding="3" border="0" summary="Navigation header"><tr>
<td width="22px" align="center" valign="middle"><a accesskey="p" href="dist.readme-missing.html"><img src="images/prev.png" width="18" height="21" border="0" alt="Prev"></a></td>
<td width="25px" align="center" valign="middle"><a accesskey="u" href="dist.html"><img src="images/up.png" width="21" height="18" border="0" alt="Up"></a></td>
<td width="31px" align="center" valign="middle"><a accesskey="h" href="index.html"><img src="images/home.png" width="27" height="20" border="0" alt="Up"></a></td>
<th align="center" valign="middle">Valgrind Distribution Documents</th>
<td width="22px" align="center" valign="middle"><a accesskey="n" href="dist.readme-packagers.html"><img src="images/next.png" width="18" height="21" border="0" alt="Next"></a></td>
</tr></table></div>
<div class="chapter">
<div class="titlepage"><div><div><h1 class="title">
<a name="dist.readme-developers"></a>6.Â README_DEVELOPERS</h1></div></div></div>
<div class="literallayout"><p><br>
Â Â Â Â Â Â BuildingÂ andÂ installingÂ it<br>
~~~~~~~~~~~~~~~~~~~~~~~~~~<br>
ToÂ build/installÂ fromÂ theÂ GITÂ repositoryÂ orÂ fromÂ aÂ distribution<br>
tarball,Â referÂ toÂ theÂ sectionÂ withÂ theÂ sameÂ nameÂ inÂ README.<br>
<br>
BuildingÂ andÂ notÂ installingÂ it<br>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>
ToÂ runÂ ValgrindÂ withoutÂ havingÂ toÂ installÂ it,Â runÂ coregrind/valgrind<br>
withÂ theÂ VALGRIND_LIBÂ environmentÂ variableÂ set,Â whereÂ &lt;dir&gt;Â isÂ theÂ root<br>
ofÂ theÂ sourceÂ treeÂ (andÂ mustÂ beÂ anÂ absoluteÂ path).Â Â Eg:<br>
<br>
Â Â VALGRIND_LIB=~/grind/head4/.in_placeÂ ~/grind/head4/coregrind/valgrindÂ <br>
<br>
ThisÂ allowsÂ youÂ toÂ compileÂ andÂ runÂ withÂ "make"Â insteadÂ ofÂ "makeÂ install",<br>
savingÂ youÂ time.<br>
<br>
Or,Â youÂ canÂ useÂ theÂ 'vg-in-place'Â scriptÂ whichÂ doesÂ thatÂ forÂ you.<br>
<br>
IÂ recommendÂ compilingÂ withÂ "makeÂ --quiet"Â toÂ furtherÂ reduceÂ theÂ amountÂ of<br>
outputÂ spewedÂ outÂ duringÂ compilation,Â lettingÂ youÂ actuallyÂ seeÂ anyÂ errors,<br>
warnings,Â etc.<br>
<br>
<br>
BuildingÂ aÂ distributionÂ tarball<br>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>
ToÂ buildÂ aÂ distributionÂ tarballÂ fromÂ theÂ valgrindÂ sources:<br>
<br>
Â Â makeÂ dist<br>
<br>
InÂ additionÂ toÂ compiling,Â linkingÂ andÂ packagingÂ everythingÂ up,Â theÂ command<br>
willÂ alsoÂ attemptÂ toÂ buildÂ theÂ documentation.<br>
<br>
IfÂ youÂ onlyÂ wantÂ toÂ testÂ whetherÂ theÂ generatedÂ tarballÂ isÂ completeÂ andÂ runs<br>
regressionÂ testsÂ successfully,Â buildingÂ documentationÂ isÂ notÂ needed.<br>
<br>
Â Â makeÂ distÂ BUILD_ALL_DOCS=no<br>
<br>
IfÂ youÂ insistÂ onÂ buildingÂ documentationÂ someÂ embarrassingÂ instructions<br>
canÂ beÂ foundÂ inÂ docs/README.<br>
<br>
<br>
RunningÂ theÂ regressionÂ tests<br>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>
ToÂ buildÂ andÂ runÂ allÂ theÂ regressionÂ tests,Â runÂ "makeÂ [--quiet]Â regtest".<br>
<br>
ToÂ runÂ aÂ subsetÂ ofÂ theÂ regressionÂ tests,Â execute:<br>
<br>
Â Â perlÂ tests/vg_regtestÂ &lt;name&gt;<br>
<br>
whereÂ &lt;name&gt;Â isÂ aÂ directoryÂ (allÂ testsÂ withinÂ willÂ beÂ run)Â orÂ aÂ single<br>
.vgtestÂ testÂ file,Â orÂ theÂ nameÂ ofÂ aÂ programÂ whichÂ hasÂ aÂ like-namedÂ .vgtest<br>
file.Â Â Eg:<br>
<br>
Â Â perlÂ tests/vg_regtestÂ memcheck<br>
Â Â perlÂ tests/vg_regtestÂ memcheck/tests/badfree.vgtest<br>
Â Â perlÂ tests/vg_regtestÂ memcheck/tests/badfree<br>
<br>
<br>
RunningÂ theÂ performanceÂ tests<br>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>
ToÂ buildÂ andÂ runÂ allÂ theÂ performanceÂ tests,Â runÂ "makeÂ [--quiet]Â perf".<br>
<br>
ToÂ runÂ aÂ subsetÂ ofÂ theÂ performanceÂ suite,Â execute:<br>
<br>
Â Â perlÂ perf/vg_perfÂ &lt;name&gt;<br>
<br>
whereÂ &lt;name&gt;Â isÂ aÂ directoryÂ (allÂ testsÂ withinÂ willÂ beÂ run)Â orÂ aÂ single<br>
.vgperfÂ testÂ file,Â orÂ theÂ nameÂ ofÂ aÂ programÂ whichÂ hasÂ aÂ like-namedÂ .vgperf<br>
file.Â Â Eg:<br>
<br>
Â Â perlÂ perf/vg_perfÂ perf/<br>
Â Â perlÂ perf/vg_perfÂ perf/bz2.vgperf<br>
Â Â perlÂ perf/vg_perfÂ perf/bz2<br>
<br>
ToÂ compareÂ multipleÂ versionsÂ ofÂ Valgrind,Â useÂ theÂ --vg=Â optionÂ multiple<br>
times.Â Â ForÂ example,Â ifÂ youÂ haveÂ twoÂ ValgrindsÂ nextÂ toÂ eachÂ other,Â oneÂ in<br>
trunk1/Â andÂ oneÂ inÂ trunk2/,Â fromÂ withinÂ eitherÂ trunk1/Â orÂ trunk2/Â doÂ thisÂ to<br>
compareÂ themÂ onÂ allÂ theÂ performanceÂ tests:<br>
<br>
Â Â perlÂ perf/vg_perfÂ --vg=../trunk1Â --vg=../trunk2Â perf/<br>
<br>
<br>
DebuggingÂ ValgrindÂ withÂ GDB<br>
~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>
ToÂ debugÂ theÂ valgrindÂ launcherÂ programÂ (&lt;prefix&gt;/bin/valgrind)Â just<br>
runÂ itÂ underÂ gdbÂ inÂ theÂ normalÂ way.<br>
<br>
DebuggingÂ theÂ mainÂ bodyÂ ofÂ theÂ valgrindÂ codeÂ (and/orÂ theÂ codeÂ for<br>
aÂ particularÂ tool)Â requiresÂ aÂ bitÂ moreÂ trickeryÂ butÂ canÂ beÂ achieved<br>
withoutÂ tooÂ muchÂ problemÂ byÂ followingÂ theseÂ steps:<br>
<br>
(1)Â SetÂ VALGRIND_LAUNCHERÂ toÂ pointÂ toÂ theÂ valgrindÂ executable.Â Â Eg:<br>
<br>
Â Â Â Â Â Â exportÂ VALGRIND_LAUNCHER=/usr/local/bin/valgrind<br>
<br>
Â Â Â Â orÂ forÂ anÂ uninstalledÂ versionÂ inÂ aÂ sourceÂ directoryÂ $DIR:<br>
<br>
Â Â Â Â Â Â exportÂ VALGRIND_LAUNCHER=$DIR/coregrind/valgrind<br>
<br>
(2)Â RunÂ gdbÂ onÂ theÂ toolÂ executable.Â Â Eg:<br>
<br>
Â Â Â Â Â Â gdbÂ /usr/local/lib/valgrind/lackey-ppc32-linux<br>
<br>
Â Â Â Â or<br>
<br>
Â Â Â Â Â Â gdbÂ $DIR/.in_place/memcheck-x86-linux<br>
<br>
(3)Â DoÂ "handleÂ SIGSEGVÂ SIGILLÂ nostopÂ noprint"Â inÂ GDBÂ toÂ preventÂ GDBÂ from<br>
Â Â Â Â stoppingÂ onÂ aÂ SIGSEGVÂ orÂ SIGILL:<br>
<br>
Â Â Â Â (gdb)Â handleÂ SIGILLÂ SIGSEGVÂ nostopÂ noprint<br>
<br>
Â Â Â Â IfÂ youÂ areÂ usingÂ lldb,Â thenÂ theÂ equivalentÂ commandÂ is<br>
<br>
Â Â Â Â (lldb)Â proÂ handÂ -pÂ trueÂ -sÂ falseÂ -nÂ falseÂ SIGILLÂ SIGSEGV<br>
<br>
(4)Â SetÂ anyÂ breakpointsÂ youÂ wantÂ andÂ proceedÂ asÂ normalÂ forÂ gdb.Â The<br>
Â Â Â Â macroÂ VG_(FUNC)Â isÂ expandedÂ toÂ vgPlain_FUNC,Â soÂ IfÂ youÂ wantÂ toÂ set<br>
Â Â Â Â aÂ breakpointÂ VG_(do_exec),Â youÂ couldÂ doÂ likeÂ thisÂ inÂ GDB:<br>
<br>
Â Â Â Â (gdb)Â bÂ vgPlain_do_exec<br>
<br>
(5)Â RunÂ theÂ toolÂ withÂ requiredÂ optionsÂ (theÂ --toolÂ optionÂ isÂ required<br>
Â Â Â Â forÂ correctÂ setup),Â e.g.<br>
<br>
Â Â Â Â (gdb)Â runÂ --tool=lackeyÂ pwd<br>
<br>
StepsÂ (1)--(3)Â canÂ beÂ putÂ inÂ aÂ .gdbinitÂ file,Â butÂ anyÂ directoryÂ namesÂ must<br>
beÂ fullyÂ expandedÂ (ie.Â notÂ anÂ environmentÂ variable).<br>
<br>
AÂ differentÂ andÂ possiblyÂ easierÂ wayÂ isÂ asÂ follows:<br>
<br>
(1)Â RunÂ ValgrindÂ asÂ normal,Â butÂ addÂ theÂ flagÂ --wait-for-gdb=yes.Â Â This<br>
Â Â Â Â putsÂ theÂ toolÂ executableÂ intoÂ aÂ waitÂ loopÂ soonÂ afterÂ itÂ gains<br>
Â Â Â Â control.Â Â ThisÂ delaysÂ startupÂ forÂ aÂ fewÂ seconds.<br>
<br>
(2)Â InÂ aÂ differentÂ shell,Â doÂ "gdbÂ /proc/&lt;pid&gt;/exeÂ &lt;pid&gt;",Â where<br>
Â Â Â Â &lt;pid&gt;Â youÂ readÂ fromÂ theÂ outputÂ printedÂ byÂ (1).Â Â ThisÂ attaches<br>
Â Â Â Â GDBÂ toÂ theÂ toolÂ executable,Â whichÂ shouldÂ beÂ inÂ theÂ abovementioned<br>
Â Â Â Â waitÂ loop.<br>
<br>
(3)Â DoÂ "cont"Â toÂ continue.Â Â AfterÂ theÂ loopÂ finishesÂ spinning,Â startup<br>
Â Â Â Â willÂ continueÂ asÂ normal.Â Â NoteÂ thatÂ commentÂ (3)Â aboveÂ reÂ passing<br>
Â Â Â Â signalsÂ appliesÂ hereÂ too.<br>
<br>
<br>
Self-hosting<br>
~~~~~~~~~~~~<br>
ThisÂ sectionÂ explainsÂ :<br>
Â Â (A)Â HowÂ toÂ configureÂ ValgrindÂ toÂ runÂ underÂ Valgrind.<br>
Â Â Â Â Â Â SuchÂ aÂ setupÂ isÂ calledÂ selfÂ hosting,Â orÂ outer/innerÂ setup.<br>
Â Â (B)Â HowÂ toÂ runÂ ValgrindÂ regressionÂ testsÂ inÂ aÂ 'self-hosting'Â mode,<br>
Â Â Â Â Â Â e.g.Â toÂ verifyÂ ValgrindÂ hasÂ noÂ bugsÂ suchÂ asÂ memoryÂ leaks.<br>
Â Â (C)Â HowÂ toÂ runÂ ValgrindÂ performanceÂ testsÂ inÂ aÂ 'self-hosting'Â mode,<br>
Â Â Â Â Â Â toÂ analyseÂ andÂ optimiseÂ theÂ performanceÂ ofÂ ValgrindÂ andÂ itsÂ tools.<br>
<br>
(A)Â HowÂ toÂ configureÂ ValgrindÂ toÂ runÂ underÂ Valgrind:<br>
<br>
(1)Â CheckÂ outÂ 2Â trees,Â "Inner"Â andÂ "Outer".Â Â InnerÂ runsÂ theÂ app<br>
Â Â Â Â directly.Â Â OuterÂ runsÂ Inner.<br>
<br>
(2)Â ConfigureÂ InnerÂ withÂ --enable-innerÂ andÂ buildÂ asÂ usual.<br>
<br>
(3)Â ConfigureÂ OuterÂ normallyÂ andÂ build+installÂ asÂ usual.<br>
Â Â Â Â Note:Â YouÂ mustÂ useÂ aÂ "makeÂ install"-edÂ valgrind.<br>
Â Â Â Â DoÂ *not*Â useÂ vg-in-placeÂ forÂ theÂ OuterÂ valgrind.<br>
<br>
(4)Â ChooseÂ aÂ veryÂ simpleÂ programÂ (date)Â andÂ try<br>
<br>
Â Â Â Â outer/.../bin/valgrindÂ --sim-hints=enable-outerÂ --trace-children=yesÂ Â \<br>
Â Â Â Â Â Â Â --smc-check=all-non-fileÂ \<br>
Â Â Â Â Â Â Â --run-libc-freeres=noÂ --tool=cachegrindÂ -vÂ \<br>
Â Â Â Â Â Â Â inner/.../vg-in-placeÂ --vgdb-prefix=./innerÂ --tool=noneÂ -vÂ prog<br>
<br>
IfÂ youÂ omitÂ theÂ --trace-children=yes,Â you'llÂ onlyÂ monitorÂ Inner'sÂ launcher<br>
program,Â notÂ itsÂ stage2.Â OuterÂ needsÂ --run-libc-freeres=no,Â asÂ otherwise<br>
itÂ willÂ tryÂ toÂ findÂ andÂ runÂ __libc_freeresÂ inÂ theÂ inner,Â whileÂ libcÂ isÂ not<br>
usedÂ byÂ theÂ inner.Â InnerÂ needsÂ --vgdb-prefix=./innerÂ toÂ avoidÂ inner<br>
gdbserverÂ collidingÂ withÂ outerÂ gdbserver.<br>
Currently,Â innerÂ doesÂ *not*Â useÂ theÂ clientÂ requestÂ <br>
VALGRIND_DISCARD_TRANSLATIONSÂ forÂ theÂ JITtedÂ codeÂ orÂ theÂ codeÂ patchedÂ for<br>
translationÂ chaining.Â SoÂ theÂ outerÂ needsÂ --smc-check=all-non-fileÂ to<br>
detectÂ theÂ modifiedÂ code.<br>
<br>
DebuggingÂ theÂ wholeÂ thingÂ mightÂ implyÂ toÂ useÂ upÂ toÂ 3Â GDB:<br>
Â Â *Â aÂ GDBÂ attachedÂ toÂ theÂ OuterÂ valgrind,Â allowing<br>
Â Â Â Â toÂ examineÂ theÂ stateÂ ofÂ Outer.<br>
Â Â *Â aÂ GDBÂ usingÂ OuterÂ gdbserver,Â allowingÂ to<br>
Â Â Â Â examineÂ theÂ stateÂ ofÂ Inner.<br>
Â Â *Â aÂ GDBÂ usingÂ InnerÂ gdbserver,Â allowingÂ to<br>
Â Â Â Â examineÂ theÂ stateÂ ofÂ prog.<br>
<br>
TheÂ wholeÂ thingÂ isÂ fragile,Â confusingÂ andÂ slow,Â butÂ itÂ doesÂ workÂ wellÂ enough<br>
forÂ youÂ toÂ getÂ someÂ usefulÂ performanceÂ data.Â Â InnerÂ hasÂ mostÂ of<br>
itsÂ outputÂ (ie.Â thoseÂ linesÂ beginningÂ withÂ "==&lt;pid&gt;==")Â prefixedÂ withÂ aÂ '&gt;',<br>
whichÂ helpsÂ aÂ lot.Â However,Â whenÂ runningÂ regressionÂ testsÂ inÂ anÂ Outer/Inner<br>
setup,Â thisÂ prefixÂ causesÂ theÂ regÂ testÂ diffÂ toÂ fail.Â GiveÂ <br>
--sim-hints=no-inner-prefixÂ toÂ theÂ InnerÂ toÂ disableÂ theÂ production<br>
ofÂ theÂ prefixÂ inÂ theÂ stdout/stderrÂ outputÂ ofÂ Inner.<br>
<br>
TheÂ allocatorsÂ inÂ coregrind/m_mallocfree.cÂ andÂ VEX/priv/main_util.hÂ are<br>
annotatedÂ withÂ clientÂ requestsÂ soÂ MemcheckÂ canÂ beÂ usedÂ toÂ findÂ leaks<br>
andÂ useÂ afterÂ freeÂ inÂ anÂ InnerÂ Valgrind.<br>
<br>
TheÂ ValgrindÂ "bigÂ lock"Â isÂ annotatedÂ withÂ helgrindÂ clientÂ requests<br>
soÂ HelgrindÂ andÂ DRDÂ canÂ beÂ usedÂ toÂ findÂ raceÂ conditionsÂ inÂ anÂ Inner<br>
Valgrind.<br>
<br>
AllÂ thisÂ hasÂ notÂ beenÂ testedÂ much,Â soÂ don'tÂ beÂ surprisedÂ ifÂ youÂ hitÂ problems.<br>
<br>
WhenÂ usingÂ self-hostingÂ withÂ anÂ outerÂ CallgrindÂ tool,Â useÂ '--pop-on-jump'<br>
(onÂ theÂ outer).Â Otherwise,Â CallgrindÂ hasÂ muchÂ higherÂ memoryÂ requirements.Â <br>
<br>
(B)Â RegressionÂ testsÂ inÂ anÂ outer/innerÂ setup:<br>
<br>
Â ToÂ runÂ allÂ theÂ regressionÂ testsÂ withÂ anÂ outerÂ memcheck,Â doÂ :<br>
Â Â Â perlÂ tests/vg_regtestÂ --outer-valgrind=../outer/.../bin/valgrindÂ \<br>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â --all<br>
<br>
Â ToÂ runÂ aÂ specificÂ regressionÂ testsÂ withÂ anÂ outerÂ memcheck,Â do:<br>
Â Â Â perlÂ tests/vg_regtestÂ --outer-valgrind=../outer/.../bin/valgrindÂ \<br>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â none/tests/args.vgtest<br>
<br>
Â ToÂ runÂ regressionÂ testsÂ withÂ anotherÂ outerÂ tool:<br>
Â Â Â perlÂ tests/vg_regtestÂ --outer-valgrind=../outer/.../bin/valgrindÂ \<br>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â --outer-tool=helgrindÂ --all<br>
<br>
Â --outer-argsÂ allowsÂ toÂ giveÂ specificÂ argumentsÂ toÂ theÂ outerÂ tool,<br>
Â replacingÂ theÂ defaultÂ oneÂ providedÂ byÂ vg_regtest.<br>
<br>
Note:Â --outer-valgrindÂ mustÂ beÂ aÂ "makeÂ install"-edÂ valgrind.<br>
DoÂ *not*Â useÂ vg-in-place.<br>
<br>
WhenÂ anÂ outerÂ valgrindÂ runsÂ anÂ innerÂ valgrind,Â aÂ regressionÂ test<br>
producesÂ oneÂ additionalÂ fileÂ &lt;testname&gt;.outer.logÂ whichÂ containsÂ the<br>
errorsÂ detectedÂ byÂ theÂ outerÂ valgrind.Â Â E.g.Â forÂ anÂ outerÂ memcheck,Â it<br>
containsÂ theÂ leaksÂ foundÂ inÂ theÂ inner,Â forÂ anÂ outerÂ helgrindÂ orÂ drd,<br>
itÂ containsÂ theÂ detectedÂ raceÂ conditions.<br>
<br>
TheÂ fileÂ tests/outer_inner.suppÂ containsÂ suppressionsÂ forÂ <br>
theÂ irrelevantÂ orÂ benignÂ errorsÂ foundÂ inÂ theÂ inner.<br>
<br>
AnÂ regressionÂ testÂ runningÂ inÂ theÂ innerÂ (e.g.Â memcheck/tests/badrw)Â will<br>
causeÂ theÂ innerÂ toÂ reportÂ anÂ error,Â whichÂ isÂ expectedÂ andÂ checked<br>
asÂ usualÂ whenÂ runningÂ theÂ regtestsÂ inÂ anÂ outer/innerÂ setup.<br>
However,Â theÂ outerÂ willÂ oftenÂ alsoÂ observeÂ anÂ error,Â e.g.Â aÂ jump<br>
usingÂ uninitialisedÂ data,Â orÂ aÂ read/writeÂ outsideÂ theÂ boundsÂ ofÂ aÂ heap<br>
block.Â WhenÂ theÂ outerÂ reportsÂ suchÂ anÂ error,Â itÂ willÂ outputÂ the<br>
innerÂ hostÂ stacktrace.Â ToÂ thisÂ stacktrace,Â itÂ willÂ appendÂ the<br>
stacktraceÂ ofÂ theÂ innerÂ guestÂ program.Â ForÂ example,Â thisÂ isÂ anÂ error<br>
reportedÂ byÂ theÂ outerÂ whenÂ theÂ innerÂ runsÂ theÂ badrwÂ regtest:<br>
Â Â ==8119==Â InvalidÂ readÂ ofÂ sizeÂ 2<br>
Â Â ==8119==Â Â Â Â atÂ 0x7F2EFD7AF:Â ???<br>
Â Â ==8119==Â Â Â Â byÂ 0x7F2C82EAF:Â ???<br>
Â Â ==8119==Â Â Â Â byÂ 0x7F180867F:Â ???<br>
Â Â ==8119==Â Â Â Â byÂ 0x40051D:Â mainÂ (badrw.c:5)<br>
Â Â ==8119==Â Â Â Â byÂ 0x7F180867F:Â ???<br>
Â Â ==8119==Â Â Â Â byÂ 0x1BFF:Â ???<br>
Â Â ==8119==Â Â Â Â byÂ 0x3803B7F0:Â _______VVVVVVVV_appended_inner_guest_stack_VVVVVVVV_______Â (m_execontext.c:332)<br>
Â Â ==8119==Â Â Â Â byÂ 0x40055C:Â mainÂ (badrw.c:22)<br>
Â Â ==8119==Â Â AddressÂ 0x55cd03cÂ isÂ 4Â bytesÂ beforeÂ aÂ blockÂ ofÂ sizeÂ 16Â alloc'd<br>
Â Â ==8119==Â Â Â Â atÂ 0x2804E26D:Â vgPlain_arena_mallocÂ (m_mallocfree.c:1914)<br>
Â Â ==8119==Â Â Â Â byÂ 0x2800BAB4:Â vgMemCheck_new_blockÂ (mc_malloc_wrappers.c:368)<br>
Â Â ==8119==Â Â Â Â byÂ 0x2800BC87:Â vgMemCheck_mallocÂ (mc_malloc_wrappers.c:403)<br>
Â Â ==8119==Â Â Â Â byÂ 0x28097EAE:Â do_client_requestÂ (scheduler.c:1861)<br>
Â Â ==8119==Â Â Â Â byÂ 0x28097EAE:Â vgPlain_schedulerÂ (scheduler.c:1425)<br>
Â Â ==8119==Â Â Â Â byÂ 0x280A7237:Â thread_wrapperÂ (syswrap-linux.c:103)<br>
Â Â ==8119==Â Â Â Â byÂ 0x280A7237:Â run_a_thread_NORETURNÂ (syswrap-linux.c:156)<br>
Â Â ==8119==Â Â Â Â byÂ 0x3803B7F0:Â _______VVVVVVVV_appended_inner_guest_stack_VVVVVVVV_______Â (m_execontext.c:332)<br>
Â Â ==8119==Â Â Â Â byÂ 0x4C294C4:Â mallocÂ (vg_replace_malloc.c:298)<br>
Â Â ==8119==Â Â Â Â byÂ 0x40051D:Â mainÂ (badrw.c:5)<br>
InÂ theÂ above,Â theÂ firstÂ stacktraceÂ startsÂ withÂ theÂ innerÂ hostÂ stacktrace,<br>
whichÂ inÂ thisÂ caseÂ isÂ someÂ JITtedÂ code.Â SuchÂ codeÂ sometimesÂ containsÂ IPs<br>
thatÂ pointsÂ inÂ theÂ innerÂ guestÂ codeÂ (0x40051D:Â mainÂ (badrw.c:5)).<br>
AfterÂ theÂ separator,Â weÂ haveÂ theÂ innerÂ guestÂ stacktrace.<br>
TheÂ secondÂ stacktraceÂ givesÂ theÂ stacktraceÂ whereÂ theÂ heapÂ blockÂ thatÂ was<br>
overrunÂ wasÂ allocated.Â WeÂ seeÂ itÂ wasÂ allocatedÂ byÂ theÂ innerÂ valgrind<br>
inÂ theÂ clientÂ arenaÂ (firstÂ partÂ ofÂ theÂ stacktrace).Â TheÂ secondÂ partÂ is<br>
theÂ guestÂ stacktraceÂ thatÂ didÂ theÂ allocation.<br>
<br>
<br>
(C)Â PerformanceÂ testsÂ inÂ anÂ outer/innerÂ setup:<br>
<br>
Â ToÂ runÂ allÂ theÂ performanceÂ testsÂ withÂ anÂ outerÂ cachegrind,Â doÂ :<br>
Â Â Â Â perlÂ perf/vg_perfÂ --outer-valgrind=../outer/.../bin/valgrindÂ perf<br>
<br>
Â ToÂ runÂ aÂ specificÂ perfÂ testÂ (e.g.Â bz2)Â inÂ thisÂ setup,Â doÂ :<br>
Â Â Â Â perlÂ perf/vg_perfÂ --outer-valgrind=../outer/.../bin/valgrindÂ perf/bz2<br>
<br>
Â ToÂ runÂ allÂ theÂ performanceÂ testsÂ withÂ anÂ outerÂ callgrind,Â doÂ :<br>
Â Â Â Â perlÂ perf/vg_perfÂ --outer-valgrind=../outer/.../bin/valgrindÂ \<br>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â --outer-tool=callgrindÂ perf<br>
<br>
Note:Â --outer-valgrindÂ mustÂ beÂ aÂ "makeÂ install"-edÂ valgrind.<br>
DoÂ *not*Â useÂ vg-in-place.<br>
<br>
Â ToÂ compareÂ theÂ performanceÂ ofÂ multipleÂ ValgrindÂ versions,Â doÂ :<br>
Â Â Â Â perlÂ perf/vg_perfÂ --outer-valgrind=../outer/.../bin/valgrindÂ \<br>
Â Â Â Â Â Â --outer-tool=callgrindÂ \<br>
Â Â Â Â Â Â --vg=../inner_xxxxÂ --vg=../inner_yyyyÂ perf<br>
Â Â (whereÂ inner_xxxxÂ andÂ inner_yyyyÂ areÂ theÂ toplevelÂ directoriesÂ of<br>
Â Â theÂ versionsÂ toÂ compare).<br>
Â Â CachegrindÂ andÂ cg_diffÂ areÂ particularlyÂ handyÂ toÂ obtainÂ aÂ delta<br>
Â Â betweenÂ theÂ twoÂ versions.<br>
<br>
WhenÂ theÂ outerÂ toolÂ isÂ callgrindÂ orÂ cachegrind,Â theÂ following<br>
outputÂ filesÂ willÂ beÂ createdÂ forÂ eachÂ test:<br>
Â Â Â &lt;outertoolname&gt;.out.&lt;inner_valgrind_dir&gt;.&lt;tt&gt;.&lt;perftestname&gt;.&lt;pid&gt;<br>
Â Â Â &lt;outertoolname&gt;.outer.log.&lt;inner_valgrind_dir&gt;.&lt;tt&gt;.&lt;perftestname&gt;.&lt;pid&gt;<br>
Â (whereÂ ttÂ isÂ theÂ twoÂ lettersÂ abbreviationÂ forÂ theÂ innerÂ tool(s)Â run).<br>
<br>
ForÂ example,Â theÂ command<br>
Â Â Â Â perlÂ perf/vg_perfÂ \<br>
Â Â Â Â Â Â --outer-valgrind=../outer_trunk/install/bin/valgrindÂ \<br>
Â Â Â Â Â Â --outer-tool=callgrindÂ \<br>
Â Â Â Â Â Â --vg=../inner_tchainÂ --vg=../inner_trunkÂ perf/many-loss-records<br>
<br>
producesÂ theÂ files<br>
Â Â Â Â callgrind.out.inner_tchain.no.many-loss-records.18465<br>
Â Â Â Â callgrind.outer.log.inner_tchain.no.many-loss-records.18465<br>
Â Â Â Â callgrind.out.inner_tchain.me.many-loss-records.21899<br>
Â Â Â Â callgrind.outer.log.inner_tchain.me.many-loss-records.21899<br>
Â Â Â Â callgrind.out.inner_trunk.no.many-loss-records.21224<br>
Â Â Â Â callgrind.outer.log.inner_trunk.no.many-loss-records.21224<br>
Â Â Â Â callgrind.out.inner_trunk.me.many-loss-records.22916<br>
Â Â Â Â callgrind.outer.log.inner_trunk.me.many-loss-records.22916<br>
<br>
<br>
PrintingÂ outÂ problematicÂ blocks<br>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br>
IfÂ youÂ wantÂ toÂ printÂ outÂ aÂ disassemblyÂ ofÂ aÂ particularÂ blockÂ that<br>
causesÂ aÂ crash,Â doÂ theÂ following.<br>
<br>
TryÂ runningÂ withÂ "--vex-guest-chase=noÂ --trace-flags=10000000<br>
--trace-notbelow=999999".Â Â ThisÂ shouldÂ printÂ oneÂ lineÂ forÂ eachÂ block<br>
translated,Â andÂ thatÂ includesÂ theÂ address.<br>
<br>
ThenÂ re-runÂ withÂ 999999Â changedÂ toÂ theÂ highestÂ bbÂ numberÂ shown.<br>
ThisÂ willÂ printÂ theÂ oneÂ lineÂ perÂ block,Â andÂ alsoÂ willÂ printÂ a<br>
disassemblyÂ ofÂ theÂ blockÂ inÂ whichÂ theÂ faultÂ occurred.<br>
<br>
Â Â Â Â </p></div>
</div>
<div>
<br><table class="nav" width="100%" cellspacing="3" cellpadding="2" border="0" summary="Navigation footer">
<tr>
<td rowspan="2" width="40%" align="left">
<a accesskey="p" href="dist.readme-missing.html">&lt;&lt;Â 5.Â README_MISSING_SYSCALL_OR_IOCTL</a>Â </td>
<td width="20%" align="center"><a accesskey="u" href="dist.html">Up</a></td>
<td rowspan="2" width="40%" align="right">Â <a accesskey="n" href="dist.readme-packagers.html">7.Â README_PACKAGERSÂ &gt;&gt;</a>
</td>
</tr>
<tr><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td></tr>
</table>
</div>
</body>
</html>
