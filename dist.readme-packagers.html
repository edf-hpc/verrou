<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>7.Â README_PACKAGERS</title>
<link rel="stylesheet" type="text/css" href="vg_basic.css">
<meta name="generator" content="DocBook XSL Stylesheets V1.79.1">
<link rel="home" href="index.html" title="Valgrind Documentation">
<link rel="up" href="dist.html" title="Valgrind Distribution Documents">
<link rel="prev" href="dist.readme-developers.html" title="6.Â README_DEVELOPERS">
<link rel="next" href="dist.readme-s390.html" title="8.Â README.S390">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div><table class="nav" width="100%" cellspacing="3" cellpadding="3" border="0" summary="Navigation header"><tr>
<td width="22px" align="center" valign="middle"><a accesskey="p" href="dist.readme-developers.html"><img src="images/prev.png" width="18" height="21" border="0" alt="Prev"></a></td>
<td width="25px" align="center" valign="middle"><a accesskey="u" href="dist.html"><img src="images/up.png" width="21" height="18" border="0" alt="Up"></a></td>
<td width="31px" align="center" valign="middle"><a accesskey="h" href="index.html"><img src="images/home.png" width="27" height="20" border="0" alt="Up"></a></td>
<th align="center" valign="middle">Valgrind Distribution Documents</th>
<td width="22px" align="center" valign="middle"><a accesskey="n" href="dist.readme-s390.html"><img src="images/next.png" width="18" height="21" border="0" alt="Next"></a></td>
</tr></table></div>
<div class="chapter">
<div class="titlepage"><div><div><h1 class="title">
<a name="dist.readme-packagers"></a>7.Â README_PACKAGERS</h1></div></div></div>
<div class="literallayout"><p><br>
Â Â Â Â Â Â <br>
Greetings,Â packagingÂ person!Â Â ThisÂ informationÂ isÂ aimedÂ atÂ people<br>
buildingÂ binaryÂ distributionsÂ ofÂ Valgrind.<br>
<br>
ThanksÂ forÂ takingÂ theÂ timeÂ andÂ effortÂ toÂ makeÂ aÂ binaryÂ distributionÂ of<br>
Valgrind.Â Â TheÂ followingÂ notesÂ mayÂ saveÂ youÂ someÂ trouble.<br>
<br>
--Â IfÂ yourÂ toolchainÂ (compiler,Â linker)Â supportÂ lto,Â usingÂ theÂ configure<br>
Â Â Â optionÂ --enable-lto=yesÂ willÂ produceÂ aÂ smaller/fasterÂ valgrind<br>
Â Â Â (upÂ toÂ 10%).<br>
<br>
--Â DoÂ notÂ shipÂ yourÂ LinuxÂ distroÂ withÂ aÂ completelyÂ stripped<br>
Â Â Â /lib/ld.so.Â Â AtÂ leastÂ leaveÂ theÂ debuggingÂ symbolÂ namesÂ onÂ --Â line<br>
Â Â Â numberÂ infoÂ isn'tÂ necessary.Â Â IfÂ youÂ don'tÂ wantÂ toÂ leaveÂ symbolsÂ on<br>
Â Â Â ld.so,Â alternativelyÂ youÂ canÂ haveÂ yourÂ distroÂ installÂ ld.so's<br>
Â Â Â debuginfoÂ packageÂ byÂ default,Â orÂ makeÂ ld.so.debuginfoÂ beÂ a<br>
Â Â Â requirementÂ ofÂ yourÂ ValgrindÂ RPM/DEB/whatever.<br>
<br>
Â Â Â ReasonÂ forÂ thisÂ isÂ thatÂ Valgrind'sÂ MemcheckÂ toolÂ needsÂ toÂ intercept<br>
Â Â Â callsÂ to,Â andÂ provideÂ replacementsÂ for,Â someÂ symbolsÂ inÂ ld.soÂ at<br>
Â Â Â startupÂ (mostÂ importantlyÂ strlen).Â Â IfÂ itÂ cannotÂ doÂ that,Â Memcheck<br>
Â Â Â showsÂ aÂ largeÂ numberÂ ofÂ falseÂ positivesÂ dueÂ toÂ theÂ highlyÂ optimised<br>
Â Â Â strlenÂ (etc)Â routinesÂ inÂ ld.so.Â Â ThisÂ hasÂ causedÂ someÂ troubleÂ in<br>
Â Â Â theÂ past.Â Â AsÂ ofÂ versionÂ 3.3.0,Â onÂ someÂ targetsÂ (ppc32-linux,<br>
Â Â Â ppc64-linux),Â MemcheckÂ willÂ simplyÂ stopÂ atÂ startupÂ (andÂ printÂ an<br>
Â Â Â errorÂ message)Â ifÂ suchÂ symbolsÂ areÂ notÂ present,Â becauseÂ itÂ is<br>
Â Â Â infeasibleÂ toÂ continue.<br>
<br>
Â Â Â It'sÂ notÂ likeÂ thisÂ isÂ goingÂ toÂ costÂ youÂ muchÂ space.Â Â WeÂ onlyÂ need<br>
Â Â Â theÂ symbolsÂ forÂ ld.soÂ (aÂ fewÂ KÂ atÂ most).Â Â NotÂ theÂ debugÂ infoÂ and<br>
Â Â Â notÂ anyÂ debuginfoÂ orÂ extraÂ symbolsÂ forÂ anyÂ otherÂ libraries.<br>
<br>
<br>
--Â (UnfortunateÂ butÂ true)Â WhenÂ youÂ configureÂ toÂ buildÂ withÂ the<br>
Â Â Â --prefix=/foo/bar/xyzzyÂ option,Â theÂ prefixÂ /foo/bar/xyzzyÂ gets<br>
Â Â Â bakedÂ intoÂ valgrind.Â Â TheÂ consequenceÂ isÂ thatÂ youÂ _must_Â install<br>
Â Â Â valgrindÂ atÂ theÂ locationÂ specifiedÂ inÂ theÂ prefix.Â Â IfÂ youÂ don't,<br>
Â Â Â itÂ mayÂ appearÂ toÂ work,Â butÂ willÂ breakÂ doingÂ someÂ obscureÂ things,<br>
Â Â Â particularlyÂ doingÂ fork()Â andÂ exec().<br>
<br>
Â Â Â SoÂ youÂ can'tÂ buildÂ aÂ relocatableÂ RPMÂ /Â whateverÂ fromÂ Valgrind.<br>
<br>
<br>
--Â Don'tÂ stripÂ theÂ debugÂ infoÂ offÂ lib/valgrind/$platform/vgpreload*.so<br>
Â Â Â inÂ theÂ installationÂ tree.Â Â EitherÂ ValgrindÂ won'tÂ workÂ atÂ all,Â orÂ it<br>
Â Â Â willÂ stillÂ workÂ ifÂ youÂ do,Â butÂ willÂ generateÂ lessÂ helpfulÂ error<br>
Â Â Â messages.Â Â Here'sÂ anÂ example:<br>
<br>
Â Â Â MismatchedÂ free()Â /Â deleteÂ /Â deleteÂ []<br>
Â Â Â Â Â Â atÂ 0x40043249:Â freeÂ (vg_clientfuncs.c:171)<br>
Â Â Â Â Â Â byÂ 0x4102BB4E:Â QGArray::~QGArray(void)Â (tools/qgarray.cpp:149)<br>
Â Â Â Â Â Â byÂ 0x4C261C41:Â PptDoc::~PptDoc(void)Â (include/qmemarray.h:60)<br>
Â Â Â Â Â Â byÂ 0x4C261F0E:Â PptXml::~PptXml(void)Â (pptxml.cc:44)<br>
Â Â Â Â Â Â AddressÂ 0x4BB292A8Â isÂ 0Â bytesÂ insideÂ aÂ blockÂ ofÂ sizeÂ 64Â alloc'd<br>
Â Â Â Â Â Â atÂ 0x4004318C:Â __builtin_vec_newÂ (vg_clientfuncs.c:152)<br>
Â Â Â Â Â Â byÂ 0x4C21BC15:Â KLaola::readSBStream(int)Â constÂ (klaola.cc:314)<br>
Â Â Â Â Â Â byÂ 0x4C21C155:Â KLaola::stream(KLaola::OLENodeÂ constÂ *)Â (klaola.cc:416)<br>
Â Â Â Â Â Â byÂ 0x4C21788F:Â OLEFilter::convert(QCStringÂ constÂ &amp;)Â (olefilter.cc:272)<br>
<br>
Â Â Â ThisÂ tellsÂ youÂ thatÂ someÂ memoryÂ allocatedÂ withÂ new[]Â wasÂ freedÂ with<br>
Â Â Â free().<br>
<br>
Â Â Â MismatchedÂ free()Â /Â deleteÂ /Â deleteÂ []<br>
Â Â Â Â Â Â atÂ 0x40043249:Â (insideÂ vgpreload_memcheck.so)<br>
Â Â Â Â Â Â byÂ 0x4102BB4E:Â QGArray::~QGArray(void)Â (tools/qgarray.cpp:149)<br>
Â Â Â Â Â Â byÂ 0x4C261C41:Â PptDoc::~PptDoc(void)Â (include/qmemarray.h:60)<br>
Â Â Â Â Â Â byÂ 0x4C261F0E:Â PptXml::~PptXml(void)Â (pptxml.cc:44)<br>
Â Â Â Â Â Â AddressÂ 0x4BB292A8Â isÂ 0Â bytesÂ insideÂ aÂ blockÂ ofÂ sizeÂ 64Â alloc'd<br>
Â Â Â Â Â Â atÂ 0x4004318C:Â (insideÂ vgpreload_memcheck.so)<br>
Â Â Â Â Â Â byÂ 0x4C21BC15:Â KLaola::readSBStream(int)Â constÂ (klaola.cc:314)<br>
Â Â Â Â Â Â byÂ 0x4C21C155:Â KLaola::stream(KLaola::OLENodeÂ constÂ *)Â (klaola.cc:416)<br>
Â Â Â Â Â Â byÂ 0x4C21788F:Â OLEFilter::convert(QCStringÂ constÂ &amp;)Â (olefilter.cc:272)<br>
<br>
Â Â Â ThisÂ isn'tÂ soÂ helpful.Â Â AlthoughÂ youÂ canÂ tellÂ thereÂ isÂ aÂ mismatch,Â <br>
Â Â Â theÂ namesÂ ofÂ theÂ allocatingÂ andÂ deallocatingÂ functionsÂ areÂ noÂ longer<br>
Â Â Â visible.Â Â TheÂ sameÂ kindÂ ofÂ thingÂ occursÂ inÂ variousÂ otherÂ messagesÂ <br>
Â Â Â fromÂ valgrind.<br>
<br>
<br>
--Â Don'tÂ stripÂ symbolsÂ fromÂ lib/valgrind/*Â inÂ theÂ installationÂ tree.<br>
Â Â Â DoingÂ soÂ willÂ likelyÂ causeÂ problems.Â Â RemovingÂ theÂ lineÂ numberÂ infoÂ is<br>
Â Â Â probablyÂ OKÂ (atÂ leastÂ forÂ someÂ ofÂ theÂ filesÂ inÂ thatÂ directory),Â although<br>
Â Â Â thatÂ hasÂ notÂ beenÂ testedÂ byÂ theÂ ValgrindÂ developers.<br>
<br>
<br>
--Â PleaseÂ testÂ theÂ finalÂ installationÂ worksÂ byÂ runningÂ itÂ onÂ something<br>
Â Â Â huge.Â Â IÂ suggestÂ checkingÂ thatÂ itÂ canÂ startÂ andÂ exitÂ successfully<br>
Â Â Â bothÂ FirefoxÂ andÂ OpenOffice.org.Â Â IÂ useÂ theseÂ asÂ testÂ programs,Â andÂ I<br>
Â Â Â knowÂ theyÂ fairlyÂ thoroughlyÂ exerciseÂ Valgrind.Â Â TheÂ commandÂ linesÂ toÂ use<br>
Â Â Â are:<br>
<br>
Â Â Â valgrindÂ -vÂ --trace-children=yesÂ firefox<br>
<br>
Â Â Â valgrindÂ -vÂ --trace-children=yesÂ soffice<br>
<br>
<br>
IfÂ youÂ findÂ anyÂ moreÂ hints/tipsÂ forÂ packaging,Â pleaseÂ report<br>
itÂ asÂ aÂ bugreport.Â SeeÂ http://www.valgrind.orgÂ forÂ details.<br>
<br>
Â Â Â Â </p></div>
</div>
<div>
<br><table class="nav" width="100%" cellspacing="3" cellpadding="2" border="0" summary="Navigation footer">
<tr>
<td rowspan="2" width="40%" align="left">
<a accesskey="p" href="dist.readme-developers.html">&lt;&lt;Â 6.Â README_DEVELOPERS</a>Â </td>
<td width="20%" align="center"><a accesskey="u" href="dist.html">Up</a></td>
<td rowspan="2" width="40%" align="right">Â <a accesskey="n" href="dist.readme-s390.html">8.Â README.S390Â &gt;&gt;</a>
</td>
</tr>
<tr><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td></tr>
</table>
</div>
</body>
</html>
